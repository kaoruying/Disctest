<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DISC 三面向測驗（連續作答＋整合報告）</title>
  <style>
    :root{
      --bg:#0b1220; --card:#121b2e; --line:#24304c;
      --text:#e9eefc; --muted:#b7c0da; --btn:#1e2a46; --btn2:#2b3a6b;
      --accent:#7aa2ff; --warn:#ffd37a;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:"Noto Sans TC","Microsoft JhengHei",system-ui,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px}
    h1{margin:0 0 10px;font-size:22px}
    h2{margin:14px 0 8px;font-size:18px}
    p{margin:8px 0;line-height:1.75;color:var(--muted)}
    .small{font-size:13px;color:var(--muted)}
    .warn{color:var(--warn)}
    .progress{display:flex;justify-content:space-between;gap:10px;align-items:center;color:var(--muted);font-size:14px}
    .bar{height:10px;background:#0e1630;border:1px solid var(--line);border-radius:999px;overflow:hidden;margin-top:10px}
    .fill{height:100%;width:0%;background:linear-gradient(90deg,#7aa2ff,#a77bff)}
    .q{font-size:18px;color:var(--text);margin-top:14px}
    .opts{margin-top:10px;display:grid;gap:10px}
    button{
      width:100%;text-align:left;padding:14px;border-radius:12px;border:1px solid var(--line);
      background:var(--btn);color:var(--text);font-size:16px;cursor:pointer
    }
    button:hover{background:var(--btn2)}
    .footer{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button.secondary{background:transparent;color:var(--muted)}
    button.secondary:hover{background:#0e1630}
    .tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:6px 10px;margin:6px 6px 0 0;color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:760px){.grid{grid-template-columns:1fr}}
    .box{background:#0e1630;border:1px solid var(--line);border-radius:16px;padding:14px}
    ul{margin:8px 0 0 18px;color:var(--text);line-height:1.75}
    li{margin:5px 0}
    .table{width:100%;border-collapse:collapse;margin-top:8px}
    .table th,.table td{border-bottom:1px solid var(--line);padding:10px 6px;text-align:left}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;color:var(--muted)}
    .center{display:grid;gap:10px}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1 id="title">DISC 三面向測驗（連續作答）</h1>
    <p class="small" id="subtitle">依序完成：生活 → 工作 → 感情（各 10 題）。最後產出整合報告：每面向主型/輔型＋三面向比較。</p>

    <div class="progress">
      <div id="progressText">尚未開始</div>
      <div class="small" id="ruleText">作答原則：選「你多數情境下最常出現的反應」</div>
    </div>
    <div class="bar"><div class="fill" id="progressFill"></div></div>

    <div id="startPanel" class="center" style="margin-top:12px"></div>

    <div class="q" id="question" style="display:none"></div>
    <div class="opts" id="options"></div>

    <div class="footer">
      <button id="startBtn">開始</button>
      <button class="secondary" id="backBtn" disabled>上一題</button>
      <button class="secondary" id="resetBtn">重設</button>
    </div>

    <div id="result" style="margin-top:14px"></div>
  </div>
</div>

<script>
/** =========================
 * 題庫：三面向各 10 題（連續作答）
 * ========================= */
const BANK = {
  life: {
    key: "life",
    name: "生活面向",
    intro: "看你在日常節奏、家人朋友互動、變動與壓力下，習慣怎麼保護自己、怎麼維持秩序或關係。",
    questions: [
      {q:"臨時被打亂原本計畫（例如行程改、事情插隊）時，你最常先做的是？",
       o:[{k:"D",t:"先定新的安排，確保事情能繼續前進"},
          {k:"I",t:"先和相關的人對齊一下，確認大家狀況"},
          {k:"S",t:"先穩住現況與節奏，慢慢把狀態拉回來"},
          {k:"C",t:"先弄清楚原因與限制，再決定怎麼調整"}]},
      {q:"朋友或家人向你抱怨一件事時，你比較自然的反應是？",
       o:[{k:"D",t:"先幫對方抓重點，直接討論怎麼解決"},
          {k:"I",t:"先陪他說，把情緒接住，讓他覺得被懂"},
          {k:"S",t:"先安撫、先站在他那邊，讓他安心"},
          {k:"C",t:"先釐清脈絡，確認問題到底是什麼"}]},
      {q:"你在生活裡最受不了的狀況通常是？",
       o:[{k:"D",t:"拖拖拉拉、沒有進度、一直卡住"},
          {k:"I",t:"氣氛很冷、大家不講清楚、互動很硬"},
          {k:"S",t:"衝突太多、被逼很急、沒有緩衝"},
          {k:"C",t:"規則混亂、標準不一、一直反覆"}]},
      {q:"當你很累或壓力大時，你比較可能怎麼做？",
       o:[{k:"D",t:"把事情切小塊，先清掉最關鍵的"},
          {k:"I",t:"找人說一說，讓自己被理解或被支持"},
          {k:"S",t:"降低刺激，回到熟悉節奏，慢慢恢復"},
          {k:"C",t:"整理、檢查、把混亂變得可控"}]},
      {q:"你買東西或做生活決定時，最常依據的是？",
       o:[{k:"D",t:"好不好用、效率高不高、立即有感"},
          {k:"I",t:"喜不喜歡、心情有沒有被照顧到"},
          {k:"S",t:"安全穩不穩、對家人/關係友不友善"},
          {k:"C",t:"規格、評價、比較後的最佳選擇"}]},
      {q:"遇到別人答應了卻沒做到，你通常會？",
       o:[{k:"D",t:"直接提醒並要求時間點，避免再拖"},
          {k:"I",t:"用比較不傷人的方式提醒，維持互動"},
          {k:"S",t:"先忍一下，等對方方便再說"},
          {k:"C",t:"確認原因與責任，再談後續如何避免"}]},
      {q:"你最容易在什麼情境下變得很急？",
       o:[{k:"D",t:"我看到明顯能推進卻大家不推"},
          {k:"I",t:"大家都悶著不講、誤會變大"},
          {k:"S",t:"環境一直變、我跟不上節奏"},
          {k:"C",t:"標準不清楚卻又要我負責結果"}]},
      {q:"別人請你幫忙時，你較常是？",
       o:[{k:"D",t:"看重點，我能直接幫你把事情搞定"},
          {k:"I",t:"我可以陪你想方法，也幫你加油"},
          {k:"S",t:"我會穩穩陪你做完，別讓你一個人扛"},
          {k:"C",t:"我會先把方法、步驟、注意事項整理好"}]},
      {q:"你心裡最需要的生活感受是？",
       o:[{k:"D",t:"掌控感與推進感"},
          {k:"I",t:"連結感與被理解"},
          {k:"S",t:"安穩感與一致性"},
          {k:"C",t:"可預期與有標準"}]},
      {q:"回想最近一段時間，你最像哪一種狀態？",
       o:[{k:"D",t:"我在推事情、解決問題、把卡點清掉"},
          {k:"I",t:"我在撐互動、讓大家好溝通"},
          {k:"S",t:"我在穩住生活、顧好關係與日常"},
          {k:"C",t:"我在補細節、控品質、避免出錯"}]},
    ]
  },

  work: {
    key: "work",
    name: "工作面向",
    intro: "看你在責任、效率、流程、協作與壓力下的習慣反應，常能反映你在職場的主型與輔型。",
    questions: [
      {q:"遇到急件但資訊不足時，你最常怎麼做？",
       o:[{k:"D",t:"先做可逆決策，推進再調整"},
          {k:"I",t:"先找關鍵人對齊，讓大家同頻"},
          {k:"S",t:"先穩住既有進度，避免牽連更多人"},
          {k:"C",t:"先補齊依據與風險，再決定"}]},
      {q:"會議討論很久沒有結論時，你通常會？",
       o:[{k:"D",t:"直接收斂選項、定案下一步"},
          {k:"I",t:"用提問引導共識，讓大家願意選"},
          {k:"S",t:"先聽各方，避免衝突擴大"},
          {k:"C",t:"把定義與評估標準拉出來再討論"}]},
      {q:"你最受不了的工作狀況是？",
       o:[{k:"D",t:"拖延、推不動、沒人承擔"},
          {k:"I",t:"缺乏互動、合作不順"},
          {k:"S",t:"變動頻繁、被逼太急、關係緊張"},
          {k:"C",t:"標準不清、反覆改、品質粗糙"}]},
      {q:"你在帶人或協作時，內在最在意的是？",
       o:[{k:"D",t:"角色權責清楚、要能推進結果"},
          {k:"I",t:"氣氛與動機要在，人才願意跟"},
          {k:"S",t:"節奏要穩，別讓人承受過量壓力"},
          {k:"C",t:"流程標準一致，事情可追蹤可複製"}]},
      {q:"當你被質疑/挑戰時，你比較常？",
       o:[{k:"D",t:"直接回到目標與成效，談結果"},
          {k:"I",t:"先看對方狀態，調整說法"},
          {k:"S",t:"先退一步，避免當下硬碰硬"},
          {k:"C",t:"拿出依據、邏輯與脈絡釐清"}]},
      {q:"壓力一大時，你最容易出現的狀態是？",
       o:[{k:"D",t:"更快、更直接、更想把事情定下來"},
          {k:"I",t:"更在意回應與認同，想把互動顧住"},
          {k:"S",t:"更想維持穩定，會把壓力先吞下來"},
          {k:"C",t:"更想把標準釐清，反覆檢查避免錯"}]},
      {q:"你做決策時最依賴的是？",
       o:[{k:"D",t:"時效與影響力（先定方向）"},
          {k:"I",t:"他人回饋與團隊狀態（先對齊）"},
          {k:"S",t:"風險與穩定性（先確保不翻車）"},
          {k:"C",t:"資料與可驗證性（先確認正確）"}]},
      {q:"你最常被人稱讚的工作特質是？",
       o:[{k:"D",t:"有效率、有決斷、扛得住"},
          {k:"I",t:"很會溝通、能帶動、好合作"},
          {k:"S",t:"很可靠、很穩、願意支持"},
          {k:"C",t:"很細、很準、品質很好"}]},
      {q:"當別人跟不上你期待的節奏，你比較常？",
       o:[{k:"D",t:"把里程碑定清楚，要求回報"},
          {k:"I",t:"多說明與鼓舞，讓對方願意動"},
          {k:"S",t:"先降低要求，慢慢把人帶上來"},
          {k:"C",t:"把標準與範例講清楚，減少落差"}]},
      {q:"回顧近期的你，你更像哪一種狀態？",
       o:[{k:"D",t:"推進、定案、把卡點打通"},
          {k:"I",t:"串聯、對齊、讓大家好合作"},
          {k:"S",t:"穩住、陪跑、維持團隊節奏"},
          {k:"C",t:"補洞、控標準、把品質拉起來"}]},
    ]
  },

  love: {
    key: "love",
    name: "感情面向",
    intro: "看你在親密關係裡對安全感、界線、被理解與被尊重的需要，以及你在不安時的保護方式。",
    questions: [
      {q:"當你感覺關係有點不對勁（怪怪的）時，你通常先？",
       o:[{k:"D",t:"直接問清楚，想把狀態拉回來"},
          {k:"I",t:"想先談談感受，希望有互動與回應"},
          {k:"S",t:"先觀察一陣子，避免衝突升高"},
          {k:"C",t:"回想細節與線索，想弄清楚原因"}]},
      {q:"對方情緒很大時，你較常？",
       o:[{k:"D",t:"先把問題框起來：我們要怎麼處理？"},
          {k:"I",t:"先接住情緒：我在，我聽你說"},
          {k:"S",t:"先安撫與陪伴，讓他慢慢穩下來"},
          {k:"C",t:"先釐清事件脈絡，避免誤會擴大"}]},
      {q:"你在感情裡最怕的狀況通常是？",
       o:[{k:"D",t:"對方不負責、問題一直拖"},
          {k:"I",t:"互動冷、沒有回應、像被晾著"},
          {k:"S",t:"衝突頻繁、氣氛緊繃、沒有安穩"},
          {k:"C",t:"說法反覆、標準不一、邏輯對不上"}]},
      {q:"你最容易在關係裡感到安全的是？",
       o:[{k:"D",t:"彼此坦白、說到做到、問題能被處理"},
          {k:"I",t:"有連結、有交流、被在乎"},
          {k:"S",t:"穩定、可預期、彼此溫柔對待"},
          {k:"C",t:"界線清楚、規則一致、彼此尊重"}]},
      {q:"當你受傷或不舒服時，你比較常？",
       o:[{k:"D",t:"先壓住情緒，直接談怎麼改善"},
          {k:"I",t:"希望對方能理解我，想把感受講出來"},
          {k:"S",t:"先忍一下，怕講了關係更不好"},
          {k:"C",t:"反覆想是不是自己哪裡做錯或沒說清楚"}]},
      {q:"你比較常用什麼方式表達在乎？",
       o:[{k:"D",t:"幫你解決、幫你扛、讓你更好"},
          {k:"I",t:"陪你聊、分享、讓你感覺被放在心上"},
          {k:"S",t:"穩定地在、照顧你、讓你有依靠"},
          {k:"C",t:"把細節做好、把承諾做到、讓你放心"}]},
      {q:"當對方跟你的期待不同，你比較常？",
       o:[{k:"D",t:"直接講期待與底線，想要調整"},
          {k:"I",t:"先用比較柔的方式說，怕傷到對方"},
          {k:"S",t:"先退一步，慢慢找合適時機談"},
          {k:"C",t:"列出具體情境與理由，讓對方理解"}]},
      {q:"你在關係裡壓力大時，最可能出現？",
       o:[{k:"D",t:"更想掌控走向，要求立刻處理"},
          {k:"I",t:"更想要回應與確認，怕被忽略"},
          {k:"S",t:"更想維持平和，寧可自己吞"},
          {k:"C",t:"更想確認細節與一致性，避免被反覆"}]},
      {q:"當你覺得對方不理解你時，你比較常冒出的是？",
       o:[{k:"D",t:"那就用行動/結果證明給你看"},
          {k:"I",t:"我需要你聽懂我的感受"},
          {k:"S",t:"我不想吵，先算了"},
          {k:"C",t:"是不是我表達不夠清楚或不夠精準"}]},
      {q:"回顧你在親密關係裡的樣子，你更像？",
       o:[{k:"D",t:"把關係往前推、把問題處理掉的人"},
          {k:"I",t:"把互動做熱、把連結撐住的人"},
          {k:"S",t:"把日常顧好、把安穩維持住的人"},
          {k:"C",t:"把承諾與界線做好、把信任撐住的人"}]},
    ]
  }
};

const ORDER = ["life","work","love"];

/** =========================
 * 四型素材（基礎）
 * ========================= */
const TYPE = {
  D: {
    name: "D（主導）",
    essence: "你在意的是推進與結果。當事情能被處理、能往前走，你會比較安定；拖著不動反而會讓你更焦躁。",
    needs: ["清楚的目標與期限", "能做主、能推進", "被尊重專業與判斷"],
    stress: ["拖延、卡關、沒人承擔", "討論很久卻不決定", "被動等待、無法掌控節奏"],
    shadow: "壓力大時，你可能更急、更直接；你不是故意壓人，而是你在用『推進』讓自己回到有掌控的狀態。",
    repair: ["把下一步定小一點：先做到 A", "用里程碑取代催促：何時回報、回報什麼", "先暫定決策，再約定驗證條件與調整點"],
    howToTreat: ["先講結論與期限", "給可選方案與權責邊界", "把事情落到里程碑與回報格式"],
    speak: [
      "句型：『我有點急，是因為事情卡住了。我需要我們在（時間）前定下一步。你比較能做 A 還是 B？』",
      "句型：『我想推進，不是要逼你。我們先做到 A，剩下的再一起調整。』"
    ],
  },
  I: {
    name: "I（影響）",
    essence: "你在意的是連結與互動。被回應、被理解會讓你比較有力量；互動變冷或被忽略時，你會更不安。",
    needs: ["被回應、被理解", "有溫度的交流", "被肯定與被邀請參與"],
    stress: ["被忽略、被冷處理", "氣氛僵硬、互動不順", "只談規則、不談感受"],
    shadow: "壓力大時，你可能更想要確認與回應；你不是黏，而是你很在意『我們有沒有連在一起』。",
    repair: ["先確認事實再說感受：我看到 X，所以我感到 Y", "把期待講成可做到的請求", "把『求確認』改成『求安排』：我們什麼時候談？"],
    howToTreat: ["先給回應（短短一句也可以）", "先肯定再談調整", "把下一步講成一起做，並落到具體安排"],
    speak: [
      "句型：『我有點不安，是因為我感覺我們沒有連上。我想聽聽你現在的想法。』",
      "句型：『我需要你給我一個回應，不用很長，一句也可以，讓我知道我們在同一邊。』"
    ],
  },
  S: {
    name: "S（穩定）",
    essence: "你在意的是安穩與合作。你很努力維持關係的平衡，也會把他人的狀態放在心上；穩定會讓你比較安心。",
    needs: ["可預期的節奏", "溫和但清楚的界線", "關係裡的互相體諒"],
    stress: ["被逼很急、變動頻繁", "衝突太直接、氣氛緊", "需要立刻表態但沒準備好"],
    shadow: "壓力大時，你可能更傾向忍耐或延後衝突；你不是沒想法，而是你在保護關係、也保護自己不被拉扯。",
    repair: ["先講影響再講需求：這樣我會跟不上，所以我需要…", "把界線說成照顧合作：我需要提前一天知道變更", "練習小步表態：先說 20% 的真實"],
    howToTreat: ["先給緩衝與預告", "用溫和但清楚的方式說需求", "避免臨時變更與逼迫"],
    speak: [
      "句型：『我需要一點時間消化，但我願意談。我們可以約（時間）再把事情說清楚。』",
      "句型：『我不是不配合，我是需要穩一點的步驟。你可以先給我一個明確的下一步嗎？』"
    ],
  },
  C: {
    name: "C（謹慎）",
    essence: "你在意的是正確與一致。標準清楚、邏輯成立時你會放鬆；規則反覆或資訊不足時，你會更焦慮，因為你在控風險。",
    needs: ["清楚定義與標準", "可驗證的依據", "一致性與可追蹤"],
    stress: ["標準不清、一直被改", "被迫在資訊不足下決策", "粗糙、不一致、無法驗證"],
    shadow: "壓力大時，你可能更難放手、反覆檢查；你不是故意挑剔，而是你在避免之後更大成本的反覆與失控。",
    repair: ["先暫定結論＋驗證清單：先做 A，若出現 B 就調整", "把標準縮到『必要標準』，其餘允許彈性", "用檢核表取代反覆思考"],
    howToTreat: ["先講標準與定義", "給依據與範圍", "允許思考/核對時間，避免臨時大改"],
    speak: [
      "句型：『我會比較安心，如果我們先把標準說清楚：什麼算完成？什麼不算？』",
      "句型：『我不是故意挑剔，我是在避免之後反覆。我們先對齊定義，後面會更省力。』"
    ],
  }
};

/** =========================
 * 12 種主輔型組合解析（每組都不同；不再用一樣的結尾）
 * ========================= */
const COMBO = {
  // D 主型
  DI: {
    title: "DI（推進＋連結）",
    lines: [
      "你會先把方向與節奏定下來（D），同時也在意人有沒有跟上、互動有沒有對齊（I）。",
      "你常見的表現是：你不只要結果，你也要『大家願意跟』。所以你會一邊推進、一邊帶動。",
      "盲點是：當你急起來，語氣會更直；別人可能只聽到壓力，忽略你其實在替大家扛進度。你的關鍵練習是：把催促換成『清楚的邀請＋期限』。"
    ],
    tip: "有效做法：先定案一個方向，再用一句話說出『我們一起做』的下一步安排。"
  },
  DS: {
    title: "DS（推進＋安穩）",
    lines: [
      "你會推進事情（D），但你也很在意關係承受度與長期穩定（S）。",
      "你常見的表現是：你不喜歡拖，但你也不想逼人。你會想把人一起帶過去，而不是自己先衝完。",
      "盲點是：你容易在『想快』和『怕給壓力』之間拉扯。你的關鍵練習是：用分工與里程碑，把壓力放在流程上，而不是放在人身上。"
    ],
    tip: "有效做法：把任務拆小＋固定回報節點，速度自然起來，人也比較不被壓到。"
  },
  DC: {
    title: "DC（推進＋標準）",
    lines: [
      "你會先推進（D），然後用標準與邏輯把事情收斂到穩（C）。",
      "你常見的表現是：你不怕做決定，但你也不想留下後遺症，所以你會回頭補定義、補規格、補責任。",
      "盲點是：壓力大時你可能又快又嚴，自己也很緊。你的關鍵練習是：先暫定結論，並寫下『驗證條件』，讓你能快、也能安心。"
    ],
    tip: "有效做法：用「暫定＋檢核表」代替反覆討論，速度與品質會同時提升。"
  },

  // I 主型
  ID: {
    title: "ID（連結＋推進）",
    lines: [
      "你會先建立互動與氣氛（I），再把行動帶起來（D）。",
      "你常見的表現是：你很會讓人想參與，也很敢在關鍵時刻把事情定下來。",
      "盲點是：當你覺得沒回應，你會更急著推，反而讓人退。你的關鍵練習是：先要到『回應』再要『行動』，順序對了，推進就不費力。"
    ],
    tip: "有效做法：先問一句「你現在怎麼看？」拿到回應後，再收斂成下一步與期限。"
  },
  IS: {
    title: "IS（連結＋安穩）",
    lines: [
      "你需要連結與被理解（I），同時也很重視安穩與關係的舒適度（S）。",
      "你常見的表現是：你很會照顧氣氛，也很會讓人安心；你在關係裡是『溫度的穩定器』。",
      "盲點是：你會把需求講得太柔，最後變成你在撐。你的關鍵練習是：把想要講成可執行的請求（時間、方式、頻率）。"
    ],
    tip: "有效做法：把「希望你在乎」翻成「我希望你在（時間）回我一句，讓我安心」。"
  },
  IC: {
    title: "IC（連結＋清楚）",
    lines: [
      "你需要互動與被理解（I），也需要語意精準與脈絡完整（C）。",
      "你常見的表現是：你不只想被安慰，你想被『正確理解』。因此你會補背景、補細節，避免被誤會。",
      "盲點是：對方跟不上時，你會越講越多、自己越累。你的關鍵練習是：先用一句話說結論與感受，再分段補資訊。"
    ],
    tip: "有效做法：先「一句結論」→ 再「兩個重點」→ 最後才「細節與例子」。"
  },

  // S 主型
  SD: {
    title: "SD（安穩＋推進）",
    lines: [
      "你重視安穩與合作（S），但必要時你也能出手推進與承擔（D）。",
      "你常見的表現是：平常你會維持和氣，但當事情拖太久，你會突然變得很果斷，因為你受不了失控。",
      "盲點是：你常把不舒服放到很後面才說，最後變成一次講很重。你的關鍵練習是：早一點用小表態，把界線說清楚。"
    ],
    tip: "有效做法：先用「我需要…」的輕量表達，避免累積到不得不爆。"
  },
  SI: {
    title: "SI（安穩＋連結）",
    lines: [
      "你重視安穩（S），也很在意互動是否溫暖、是否有連上（I）。",
      "你常見的表現是：你願意配合，也願意照顧人；你很擅長把緊張變成柔和。",
      "盲點是：你太會體諒，容易把自己的需求往後放。你的關鍵練習是：把體諒留著，但別把自己放掉。"
    ],
    tip: "有效做法：先肯定對方，再直接提出一個你需要的具體安排（時間/做法）。"
  },
  SC: {
    title: "SC（安穩＋標準）",
    lines: [
      "你需要安穩與可預期（S），也需要規則一致與可追蹤（C）。",
      "你常見的表現是：你願意配合，但你會希望事情有流程、有標準，這樣你才安心、也比較不會反覆。",
      "盲點是：你可能默默做很多，卻不說標準；結果別人照著自己的方式做，你更累。你的關鍵練習是：把必要標準說在前面。"
    ],
    tip: "有效做法：先把「必要標準」列 3 點，其餘允許彈性，你會輕很多。"
  },

  // C 主型
  CD: {
    title: "CD（標準＋推進）",
    lines: [
      "你先用標準與邏輯確保正確（C），一旦你有底了，你會推得很快（D）。",
      "你常見的表現是：你不是慢，你是先把風險算清楚；等你確定方向，你的執行力會突然加速。",
      "盲點是：外界可能催你快，你就更緊。你的關鍵練習是：先講『我需要的資訊/定義』，讓別人知道你在等什麼。"
    ],
    tip: "有效做法：用一句話說清楚「我缺哪個資訊」＋「我拿到後多久能定案」。"
  },
  CI: {
    title: "CI（標準＋連結）",
    lines: [
      "你重視一致與正確（C），也在意互動是否被公平理解（I）。",
      "你常見的表現是：你會想把事情講清楚，也會想確認對方有沒有真的懂你；你在守的是『不要誤會、不要失信』。",
      "盲點是：你容易在腦中反覆推演，越想越多。你的關鍵練習是：用例子或具體情境，取代抽象解釋。"
    ],
    tip: "有效做法：先給一個具體例子（發生什麼）→ 再講你的標準（你要什麼）。"
  },
  CS: {
    title: "CS（標準＋安穩）",
    lines: [
      "你重視標準與正確（C），也重視關係承受度與穩定（S）。",
      "你常見的表現是：你把事情做對、做穩，也把人顧好；你很可靠，但也容易累，因為你常把責任與關係一起扛。",
      "盲點是：你可能不想麻煩別人，結果全部自己補。你的關鍵練習是：你負責標準與結論，別人負責配合與回報。"
    ],
    tip: "有效做法：把「回報格式」與「完成定義」寫清楚，事情會更省你力。"
  },
};

/** =========================
 * 狀態：跨三面向累積
 * ========================= */
const $ = (id)=>document.getElementById(id);

let started = false;
let sectionIndex = 0;
let qIndex = 0;
let entries = []; // {sectionKey,qIndex,pickKey,pickText}
let scoresBySection = {
  life: {D:0,I:0,S:0,C:0},
  work: {D:0,I:0,S:0,C:0},
  love: {D:0,I:0,S:0,C:0},
};

function resetAll(){
  started = false;
  sectionIndex = 0;
  qIndex = 0;
  entries = [];
  scoresBySection = {
    life: {D:0,I:0,S:0,C:0},
    work: {D:0,I:0,S:0,C:0},
    love: {D:0,I:0,S:0,C:0},
  };

  $("result").innerHTML = "";
  $("question").style.display = "none";
  $("question").textContent = "";
  $("options").innerHTML = "";
  $("progressText").textContent = "尚未開始";
  $("progressFill").style.width = "0%";
  $("backBtn").disabled = true;
  $("startBtn").style.display = "";

  renderStartPanel();
}

function renderStartPanel(){
  $("startPanel").innerHTML = `
    <div class="box">
      <h2 style="margin-top:0">作答流程</h2>
      <ul>
        <li>依序完成：<b>生活 → 工作 → 感情</b>（各 10 題）</li>
        <li>每題選「你多數情境下最常出現的反應」</li>
        <li>最後會給你：每個面向的主型/輔型＋<b>三面向整合比較</b></li>
      </ul>
      <p class="small warn">提醒：這是自我理解工具，不是診斷；若你正處於高壓或關係拉扯，結果可當作整理方向的起點。</p>
    </div>
  `;
}

function start(){
  started = true;
  $("startBtn").style.display = "none";
  $("question").style.display = "block";
  render();
}

function sectionKey(){ return ORDER[sectionIndex]; }
function sectionObj(){ return BANK[sectionKey()]; }

function totalQuestionsAll(){
  return ORDER.reduce((sum,k)=>sum + BANK[k].questions.length, 0);
}
function currentNumberAll(){
  const donePrev = ORDER.slice(0, sectionIndex).reduce((sum,k)=>sum + BANK[k].questions.length, 0);
  return donePrev + qIndex + 1;
}

function calcScores(){
  scoresBySection = {
    life: {D:0,I:0,S:0,C:0},
    work: {D:0,I:0,S:0,C:0},
    love: {D:0,I:0,S:0,C:0},
  };
  for(const e of entries){
    scoresBySection[e.sectionKey][e.pickKey] += 1;
  }
}

function back(){
  if(entries.length === 0) return;
  const last = entries.pop();
  sectionIndex = ORDER.indexOf(last.sectionKey);
  qIndex = last.qIndex;
  calcScores();
  $("result").innerHTML = "";
  render();
}

function pick(opt){
  entries.push({sectionKey: sectionKey(), qIndex, pickKey: opt.k, pickText: opt.t});

  qIndex += 1;
  if(qIndex >= sectionObj().questions.length){
    sectionIndex += 1;
    qIndex = 0;
  }
  calcScores();
  render();
}

function pct(v,total){ return total===0 ? 0 : Math.round(v/total*100); }
function sortedScores(scoreObj){
  const arr = Object.entries(scoreObj).map(([k,v])=>({k,v}));
  arr.sort((a,b)=> b.v - a.v);
  return arr;
}
function classify(scoreObj){
  const arr = sortedScores(scoreObj);
  const max = arr[0].v;
  const second = arr.find(x=>x.v < max)?.v ?? max;
  const primary = arr.filter(x=>x.v === max).map(x=>x.k);
  const secondary = arr.filter(x=>x.v === second && !primary.includes(x.k)).map(x=>x.k);
  return {arr, max, second, primary, secondary};
}
function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, s => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
  }[s]));
}

function render(){
  $("startPanel").innerHTML = "";

  if(!started){
    $("question").style.display = "none";
    $("options").innerHTML = "";
    return;
  }

  const totalAll = totalQuestionsAll();
  const nowAll = currentNumberAll();
  const answered = entries.length;
  $("progressText").textContent = `進度：第 ${Math.min(nowAll, totalAll)} / 共 ${totalAll} 題`;
  $("progressFill").style.width = `${Math.round((answered/totalAll)*100)}%`;
  $("backBtn").disabled = entries.length === 0;

  // 全部完成
  if(sectionIndex >= ORDER.length){
    $("title").textContent = "DISC 三面向測驗（完成）";
    $("subtitle").textContent = "以下是整合報告：三個面向各自的主型/輔型、主輔型組合解析、以及三面向比較。";
    $("question").textContent = "已完成三個面向";
    $("options").innerHTML = "";
    $("result").innerHTML = buildIntegratedReport();
    return;
  }

  // 當前面向
  const sec = sectionObj();
  $("title").textContent = `DISC 測驗｜${sec.name}`;
  $("subtitle").textContent = sec.intro;

  const q = sec.questions[qIndex];
  $("question").innerHTML = `
    <span class="pill"><b style="color:var(--accent)">${sec.name}</b></span>
    <span class="pill"><b style="color:var(--accent)">第 ${qIndex+1} / ${sec.questions.length} 題</b></span>
    <span class="pill"><b style="color:var(--accent)">總進度 ${nowAll} / ${totalAll}</b></span>
    <div style="margin-top:10px">${escapeHtml(q.q)}</div>
  `;

  const box = $("options");
  box.innerHTML = "";
  q.o.forEach((opt, i)=>{
    const b = document.createElement("button");
    b.innerHTML = `<b style="color:var(--accent)">(${String.fromCharCode(65+i)})</b> ${escapeHtml(opt.t)}`;
    b.onclick = ()=>pick(opt);
    box.appendChild(b);
  });

  $("result").innerHTML = "";
}

/** =========================
 * 報告產生
 * ========================= */
function labelPrimarySecondary(primary, secondary){
  const pText = primary.length===1 ? TYPE[primary[0]].name : `並列主型：${primary.map(k=>TYPE[k].name).join("、")}`;
  const sText = secondary.length===1 ? TYPE[secondary[0]].name : (secondary.length>1 ? `並列輔型：${secondary.map(k=>TYPE[k].name).join("、")}` : "輔型不明顯（分數接近）");
  return {pText, sText};
}

function buildAnalysisBlock(title, scoreObj, sectionName){
  const total = Object.values(scoreObj).reduce((a,b)=>a+b,0);
  const {arr, primary, secondary, max, second} = classify(scoreObj);
  const {pText, sText} = labelPrimarySecondary(primary, secondary);

  const reliability = `此面向題數為 ${total} 題，屬輪廓理解；若要更精準，可擴充題目（例如 16／24 題）。`;

  const analysis = (primary.length===1)
    ? buildSinglePrimaryAnalysis(primary[0], secondary.length===1 ? secondary[0] : null, max, second, sectionName)
    : buildMultiPrimaryAnalysis(primary, sectionName);

  return `
    <div class="box" style="margin-top:12px">
      <h2 style="margin-top:0">${title}</h2>
      <div class="tag">面向：<b style="color:var(--text)">${sectionName}</b></div>
      <div class="tag">主型：<b style="color:var(--text)">${pText}</b></div>
      <div class="tag">輔型：<b style="color:var(--text)">${sText}</b></div>
      <p class="small warn">${reliability}</p>

      <h2>分數分布</h2>
      <table class="table">
        <thead><tr><th>向度</th><th>分數</th><th>比例</th></tr></thead>
        <tbody>
          ${arr.map(x=>`
            <tr>
              <td>${TYPE[x.k].name}</td>
              <td>${x.v}</td>
              <td>${pct(x.v,total)}%</td>
            </tr>
          `).join("")}
        </tbody>
      </table>

      ${analysis}

      <div class="grid" style="margin-top:12px">
        <div class="box">
          <h2 style="margin-top:0">你在這個面向裡，最需要被怎麼對待</h2>
          ${buildHowToTreat(primary, secondary)}
        </div>
        <div class="box">
          <h2 style="margin-top:0">你可以怎麼說，既保護自己也不把關係推遠</h2>
          ${buildSpeak(primary, secondary)}
        </div>
      </div>

      <div class="box" style="margin-top:12px">
        <h2 style="margin-top:0">主型＋輔型的互動解析</h2>
        ${buildSecondaryAnalysis(primary, secondary)}
      </div>

      <div class="box" style="margin-top:12px">
        <h2 style="margin-top:0">在壓力上來的時候，你可以怎麼把自己拉回來</h2>
        ${buildRepair(primary, secondary)}
      </div>
    </div>
  `;
}

function buildSinglePrimaryAnalysis(p, s, max, second, sectionName){
  const gap = max - second;
  const gapLine = gap >= 3
    ? "你的主型很突出，代表你在這個面向裡的習慣反應相對一致。"
    : "你的主型與其他向度差距不大，代表你有彈性，但也可能更容易感到拉扯。";

  let comboHTML = "";
  if(s){
    const key = `${p}${s}`;
    const pack = COMBO[key];
    if(pack){
      comboHTML = `
        <p class="small">你的主輔型組合：<b style="color:var(--text)">${pack.title}</b></p>
        <ul>${pack.lines.map(x=>`<li>${x}</li>`).join("")}</ul>
        <p class="small muted"><b>建議用法：</b>${pack.tip}</p>
      `;
    }else{
      comboHTML = `
        <p class="small">你的主輔型組合：<b style="color:var(--text)">${p}${s}</b></p>
        <ul>
          <li>你在此面向以 ${TYPE[p].name} 為主軸，同時帶著 ${TYPE[s].name} 的調節策略。</li>
          <li>你的反應會依情境在兩種策略間切換：一種是主軸，一種是保護與調節。</li>
          <li>你最需要的是：把界線、下一步、責任說清楚，讓你不用用情緒撐進度。</li>
        </ul>
      `;
    }
  } else {
    comboHTML = `
      <p class="small">你的輔型不明顯（分數接近），表示你在此面向會依情境切換策略。</p>
      <ul>
        <li>你不是沒有主軸，而是你更擅長「看情境選方法」。</li>
        <li>當你覺得累，多半不是性格問題，而是你的責任與界線沒有被說清楚。</li>
        <li>先把「你能做什麼 / 不能做什麼」講清楚，你會輕很多。</li>
      </ul>
    `;
  }

  const pStress = TYPE[p].stress[0] || "某些不確定與壓力情境";
  const pNeed = TYPE[p].needs[0] || "一些你很在意的需要";

  return `
    <div class="box" style="margin-top:12px">
      <h2 style="margin-top:0">解析（${sectionName}）</h2>
      <p><b>${TYPE[p].name}</b>：${TYPE[p].essence}</p>
      <p class="small">${gapLine}</p>

      <div class="box" style="margin-top:10px">
        <h2 style="margin-top:0">主輔型搭配說明</h2>
        ${comboHTML}
      </div>

      <div class="grid" style="margin-top:10px">
        <div class="box">
          <h2 style="margin-top:0">你在這個面向裡的核心模式</h2>
          <ul>
            <li><b>常見觸發點：</b>${pStress}</li>
            <li><b>你會怎麼保護自己：</b>${TYPE[p].shadow}</li>
            <li><b>你其實在守護的是：</b>${pNeed}</li>
          </ul>
          <p class="small">這不是貼標籤，而是把你的「自動反應」看清楚；看清楚後，你才有空間選更舒服的做法。</p>
        </div>
        <div class="box">
          <h2 style="margin-top:0">你比較容易回到穩定的方式</h2>
          <ul>${TYPE[p].repair.map(x=>`<li>${x}</li>`).join("")}</ul>
        </div>
      </div>
    </div>
  `;
}

function buildMultiPrimaryAnalysis(primary, sectionName){
  const names = primary.map(k=>TYPE[k].name).join("、");
  return `
    <div class="box" style="margin-top:12px">
      <h2 style="margin-top:0">解析（並列主型｜${sectionName}）</h2>
      <p>你在此面向呈現「並列主型（${names}）」。這通常意味著：你會依情境啟用不同策略，而不是沒有主軸。</p>
      <p class="small">若你想分辨哪一個更像核心，可在此面向加題數，或把題目改得更貼近你常遇到的真實情境。</p>
    </div>
  `;
}

function buildHowToTreat(primary, secondary){
  if(primary.length === 1){
    const p = primary[0];
    const s = (secondary.length === 1) ? secondary[0] : null;
    const extra = s ? `<p class="small">輔型加分（${TYPE[s].name}）：${TYPE[s].howToTreat[0]}。</p>` : "";
    return `<ul>${TYPE[p].howToTreat.map(x=>`<li>${x}</li>`).join("")}</ul>${extra}`;
  }
  return `
    <ul>
      <li>先確認此刻對方最在意的是：速度、互動、安穩，或標準。</li>
      <li>把回覆變具體：時間點、下一步、責任與範圍。</li>
      <li>少猜、多對齊：用一句話確認彼此理解。</li>
    </ul>
  `;
}

function buildSpeak(primary, secondary){
  if(primary.length === 1){
    const p = primary[0];
    const s = (secondary.length === 1) ? secondary[0] : null;
    const extra = s ? `<p class="small">輔型提醒：你使用 ${TYPE[s].name} 的方式調節時，關係會更容易穩下來。</p>` : "";
    return `<ul>${TYPE[p].speak.map(x=>`<li>${x}</li>`).join("")}</ul>${extra}`;
  }
  return `
    <ul>
      <li>先說狀態：我現在有點…</li>
      <li>再說事實：因為發生了…</li>
      <li>最後說請求：我需要你…／我們可不可以…</li>
    </ul>
  `;
}

// 這一段也改成用 COMBO（每組不同），不再給一樣的通用結尾
function buildSecondaryAnalysis(primary, secondary){
  if(primary.length === 1 && secondary.length === 1){
    const key = `${primary[0]}${secondary[0]}`;
    const pack = COMBO[key];
    if(pack){
      return `
        <p class="small"><b>${pack.title}</b></p>
        <ul>${pack.lines.map(x=>`<li>${x}</li>`).join("")}</ul>
        <p class="small muted"><b>建議用法：</b>${pack.tip}</p>
      `;
    }
    return `
      <ul>
        <li>你在此面向以 ${TYPE[primary[0]].name} 為主軸，同時帶著 ${TYPE[secondary[0]].name} 的調節策略。</li>
        <li>若你覺得容易累，通常是「界線與分工不清」或「期待沒有對齊」。</li>
        <li>把下一步講清楚，你會更穩。</li>
      </ul>
    `;
  }
  return `
    <ul>
      <li>主型是你在此面向的第一反應；輔型是你用來調節與保護的第二套策略。</li>
      <li>若出現並列主型/輔型，表示你情境切換明顯；想更清楚可增加題數。</li>
      <li>實務上，把需求具體化（時間點、範圍、下一步）比追求完美分類更有用。</li>
    </ul>
  `;
}

function buildRepair(primary, secondary){
  if(primary.length === 1){
    const p = primary[0];
    const s = (secondary.length===1) ? secondary[0] : null;
    const extra = s ? `<p class="small">輔型提醒：你也可以用 ${TYPE[s].name} 的方式（例如：${TYPE[s].repair[0]}）幫自己回穩。</p>` : "";
    return `<ul>${TYPE[p].repair.map(x=>`<li>${x}</li>`).join("")}</ul>${extra}`;
  }
  return `
    <ul>
      <li>先把需求變具體：時間點、範圍、下一步。</li>
      <li>如果你在反覆想：先暫定一個結論，約定驗證點。</li>
      <li>如果你在吞：先用小表態說出一個需求，不用一次說完。</li>
    </ul>
  `;
}

/** =========================
 * 整合報告
 * ========================= */
function buildIntegratedReport(){
  return `
    <div class="box">
      <h2 style="margin-top:0">整合報告</h2>
      <p>以下依序呈現：生活／工作／感情三個面向的主型＋輔型與解析，最後提供跨面向比較。</p>
      <div class="footer" style="margin-top:10px">
        <button class="secondary" onclick="resetAll()">重新開始</button>
      </div>
    </div>
    ${buildAnalysisBlock("生活面向報告", scoresBySection.life, "生活面向")}
    ${buildAnalysisBlock("工作面向報告", scoresBySection.work, "工作面向")}
    ${buildAnalysisBlock("感情面向報告", scoresBySection.love, "感情面向")}
    ${buildComparisonBlock()}
  `;
}

function buildComparisonBlock(){
  const sec = {
    life: scoresBySection.life,
    work: scoresBySection.work,
    love: scoresBySection.love
  };
  const dims = ["D","I","S","C"];
  const dimName = {D:"主導", I:"影響", S:"穩定", C:"謹慎"};
  const secName = {life:"生活", work:"工作", love:"感情"};

  const highlights = dims.map(d=>{
    const arr = Object.entries(sec).map(([k,v])=>({section:k, val:v[d]}));
    arr.sort((a,b)=>b.val-a.val);
    return {d, top:arr[0], second:arr[1], gap:arr[0].val - arr[1].val};
  });

  const bySectionHighlight = Object.entries(sec).map(([k,v])=>{
    const arr = sortedScores(v);
    return {section:k, top:arr[0], second:arr[1], gap:arr[0].v - arr[1].v};
  });

  // 用差距最大的 2 個向度做整合敘事（不寫制式通用句）
  const strongest = [...highlights].sort((a,b)=>b.gap-a.gap).slice(0,2);
  const explain = {
    D:"你在該面向更常用「推進與掌控」來穩住局面。",
    I:"你在該面向更常用「互動與回應」來確認安全感。",
    S:"你在該面向更常用「維持安穩與節奏」來避免失衡。",
    C:"你在該面向更常用「標準與一致」來降低不確定。"
  };

  const narrative = strongest.map(s=>{
    const dim = `${s.d}（${dimName[s.d]}）`;
    return `<li><b>${dim}</b>最高的面向是<b>${secName[s.top.section]}</b>（差距 ${s.gap}）。${explain[s.d]}</li>`;
  }).join("");

  return `
    <div class="box" style="margin-top:12px">
      <h2 style="margin-top:0">跨面向比較</h2>

      <h2>以向度看（D / I / S / C）</h2>
      <table class="table">
        <thead><tr><th>向度</th><th>最高面向</th><th>分數</th><th>次高面向</th><th>差距</th></tr></thead>
        <tbody>
          ${highlights.map(h=>`
            <tr>
              <td>${h.d}（${dimName[h.d]}）</td>
              <td>${secName[h.top.section]}</td>
              <td>${h.top.val}</td>
              <td>${secName[h.second.section]}</td>
              <td>${h.gap}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>

      <h2>以面向看（生活 / 工作 / 感情）</h2>
      <table class="table">
        <thead><tr><th>面向</th><th>最突出向度</th><th>分數</th><th>次高</th><th>差距</th></tr></thead>
        <tbody>
          ${bySectionHighlight.map(s=>`
            <tr>
              <td>${secName[s.section]}</td>
              <td>${TYPE[s.top.k].name}</td>
              <td>${s.top.v}</td>
              <td>${TYPE[s.second.k].name}</td>
              <td>${s.gap}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>

      <h2>整合解讀（看差距最大的地方）</h2>
      <ul>${narrative}</ul>
      <p class="small">差距越大，代表你在該面向越固定使用那種策略；差距小則表示你會依情境切換。</p>
    </div>
  `;
}

/** 綁定 */
$("startBtn").addEventListener("click", start);
$("backBtn").addEventListener("click", back);
$("resetBtn").addEventListener("click", resetAll);

/** 初始化 */
resetAll();
</script>
</body>
</html>
