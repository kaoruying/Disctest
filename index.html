<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DISC測驗</title>
  <style>
    :root{
      --bg:#0b1220; --card:#121b2e; --line:#24304c;
      --text:#e9eefc; --muted:#b7c0da; --btn:#1e2a46; --btn2:#2b3a6b;
      --accent:#7aa2ff;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:"Noto Sans TC","Microsoft JhengHei",system-ui,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px}
    h1{margin:0 0 10px;font-size:22px}
    h2{margin:14px 0 8px;font-size:18px}
    p{margin:8px 0;line-height:1.75;color:var(--muted)}
    .small{font-size:13px;color:var(--muted)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;color:var(--muted)}
    .q{font-size:18px;color:var(--text);margin-top:14px}
    .opts{margin-top:10px;display:grid;gap:10px}
    button{
      width:100%;text-align:left;padding:14px;border-radius:12px;border:1px solid var(--line);
      background:var(--btn);color:var(--text);font-size:16px;cursor:pointer
    }
    button:hover{background:var(--btn2)}
    button.secondary{background:transparent;color:var(--muted)}
    button.secondary:hover{background:#0e1630}
    button.smallBtn{padding:10px 12px;font-size:14px}
    .footer{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:6px 10px;margin:6px 6px 0 0;color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:760px){.grid{grid-template-columns:1fr}}
    .box{background:#0e1630;border:1px solid var(--line);border-radius:16px;padding:14px}
    ul{margin:8px 0 0 18px;color:var(--text);line-height:1.75}
    li{margin:5px 0}
    .table{width:100%;border-collapse:collapse;margin-top:8px}
    .table th,.table td{border-bottom:1px solid var(--line);padding:10px 6px;text-align:left}
    .muted{color:var(--muted)}
    .menuGrid{display:grid;gap:10px;margin-top:10px}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1 id="title">DISC測驗</h1>
    <p class="small" id="subtitle">選一個面向開始作答（各 10 題）。每個面向的作答與結果彼此獨立。</p>

    <div id="menu" class="menuGrid"></div>

    <div id="testArea" style="display:none">
      <div class="row" style="margin-top:10px">
        <span class="pill" id="sectionPill"></span>
        <span class="pill" id="qPill"></span>
      </div>

      <div class="q" id="question"></div>
      <div class="opts" id="options"></div>

      <div class="footer">
        <button class="secondary smallBtn" id="backBtn" disabled>上一題</button>
        <button class="secondary smallBtn" id="restartBtn">重作此面向</button>
        <button class="secondary smallBtn" id="homeBtn">回首頁</button>
      </div>

      <div id="result" style="margin-top:14px"></div>
    </div>
  </div>
</div>

<script>
/** =========================
 * 題庫：三面向各 10 題（彼此獨立）
 * ========================= */
const BANK = {
  life: {
    key: "life",
    name: "生活面向",
    intro: "看你在日常節奏、家人朋友互動、變動與壓力下的習慣反應。",
    questions: [
      {q:"臨時被打亂原本計畫（例如行程改、事情插隊）時，你最常先做的是？",
       o:[{k:"D",t:"先定新的安排，確保事情能繼續前進"},
          {k:"I",t:"先和相關的人對齊一下，確認大家狀況"},
          {k:"S",t:"先穩住現況與節奏，慢慢把狀態拉回來"},
          {k:"C",t:"先弄清楚原因與限制，再決定怎麼調整"}]},
      {q:"朋友或家人向你抱怨一件事時，你比較自然的反應是？",
       o:[{k:"D",t:"先幫對方抓重點，直接討論怎麼解決"},
          {k:"I",t:"先陪他說，把情緒接住，讓他覺得被懂"},
          {k:"S",t:"先安撫、先站在他那邊，讓他安心"},
          {k:"C",t:"先釐清脈絡，確認問題到底是什麼"}]},
      {q:"你在生活裡最受不了的狀況通常是？",
       o:[{k:"D",t:"拖拖拉拉、沒有進度、一直卡住"},
          {k:"I",t:"氣氛很冷、大家不講清楚、互動很硬"},
          {k:"S",t:"衝突太多、被逼很急、沒有緩衝"},
          {k:"C",t:"規則混亂、標準不一、一直反覆"}]},
      {q:"當你很累或壓力大時，你比較可能怎麼做？",
       o:[{k:"D",t:"把事情切小塊，先清掉最關鍵的"},
          {k:"I",t:"找人說一說，讓自己被理解或被支持"},
          {k:"S",t:"降低刺激，回到熟悉節奏，慢慢恢復"},
          {k:"C",t:"整理、檢查、把混亂變得可控"}]},
      {q:"你買東西或做生活決定時，最常依據的是？",
       o:[{k:"D",t:"好不好用、效率高不高、立即有感"},
          {k:"I",t:"喜不喜歡、心情有沒有被照顧到"},
          {k:"S",t:"安全穩不穩、對家人/關係友不友善"},
          {k:"C",t:"規格、評價、比較後的最佳選擇"}]},
      {q:"遇到別人答應了卻沒做到，你通常會？",
       o:[{k:"D",t:"直接提醒並要求時間點，避免再拖"},
          {k:"I",t:"用比較不傷人的方式提醒，維持互動"},
          {k:"S",t:"先忍一下，等對方方便再說"},
          {k:"C",t:"確認原因與責任，再談後續如何避免"}]},
      {q:"你最容易在什麼情境下變得很急？",
       o:[{k:"D",t:"我看到明顯能推進卻大家不推"},
          {k:"I",t:"大家都悶著不講、誤會變大"},
          {k:"S",t:"環境一直變、我跟不上節奏"},
          {k:"C",t:"標準不清楚卻又要我負責結果"}]},
      {q:"別人請你幫忙時，你較常是？",
       o:[{k:"D",t:"看重點，我能直接幫你把事情搞定"},
          {k:"I",t:"我可以陪你想方法，也幫你加油"},
          {k:"S",t:"我會穩穩陪你做完，別讓你一個人扛"},
          {k:"C",t:"我會先把方法、步驟、注意事項整理好"}]},
      {q:"你心裡最需要的生活感受是？",
       o:[{k:"D",t:"掌控感與推進感"},
          {k:"I",t:"連結感與被理解"},
          {k:"S",t:"安穩感與一致性"},
          {k:"C",t:"可預期與有標準"}]},
      {q:"回想最近一段時間，你最像哪一種狀態？",
       o:[{k:"D",t:"我在推動前進、解決問題、把卡點清掉"},
          {k:"I",t:"我在撐互動、讓大家好溝通"},
          {k:"S",t:"我在穩住生活、顧好關係與日常"},
          {k:"C",t:"我在補細節、控品質、避免出錯"}]},
    ]
  },

  work: {
    key: "work",
    name: "工作面向",
    intro: "看你在責任、效率、流程、協作與壓力下的習慣反應。",
    questions: [
      {q:"遇到急件但資訊不足時，你最常怎麼做？",
       o:[{k:"D",t:"先做可逆決策，推進再調整"},
          {k:"I",t:"先找關鍵人對齊，讓大家同頻"},
          {k:"S",t:"先穩住既有進度，避免牽連更多人"},
          {k:"C",t:"先補齊依據與風險，再決定"}]},
      {q:"會議討論很久沒有結論時，你通常會？",
       o:[{k:"D",t:"直接收斂選項、定案下一步"},
          {k:"I",t:"用提問引導共識，讓大家願意選"},
          {k:"S",t:"先聽各方，避免衝突擴大"},
          {k:"C",t:"把定義與評估標準拉出來再討論"}]},
      {q:"你最受不了的工作狀況是？",
       o:[{k:"D",t:"拖延、推不動、沒人承擔"},
          {k:"I",t:"缺乏互動、合作不順"},
          {k:"S",t:"變動頻繁、被逼太急、關係緊張"},
          {k:"C",t:"標準不清、反覆改、品質粗糙"}]},
      {q:"你在帶人或協作時，內在最在意的是？",
       o:[{k:"D",t:"角色權責清楚、要能推進結果"},
          {k:"I",t:"氣氛與動機要在，人才願意跟"},
          {k:"S",t:"節奏要穩，別讓人承受過量壓力"},
          {k:"C",t:"流程標準一致，事情可追蹤可複製"}]},
      {q:"當你被質疑/挑戰時，你比較常？",
       o:[{k:"D",t:"直接回到目標與成效，談結果"},
          {k:"I",t:"先看對方狀態，調整說法"},
          {k:"S",t:"先退一步，避免當下硬碰硬"},
          {k:"C",t:"拿出依據、邏輯與脈絡釐清"}]},
      {q:"壓力一大時，你最容易出現的狀態是？",
       o:[{k:"D",t:"更快、更直接、更想把事情定下來"},
          {k:"I",t:"更在意回應與認同，想把互動顧住"},
          {k:"S",t:"更想維持穩定，會把壓力先吞下來"},
          {k:"C",t:"更想把標準釐清，反覆檢查避免錯"}]},
      {q:"你做決策時最依賴的是？",
       o:[{k:"D",t:"時效與影響力（先定方向）"},
          {k:"I",t:"他人回饋與團隊狀態（先對齊）"},
          {k:"S",t:"風險與穩定性（先確保不翻車）"},
          {k:"C",t:"資料與可驗證性（先確認正確）"}]},
      {q:"你最常被人稱讚的工作特質是？",
       o:[{k:"D",t:"有效率、有決斷、扛得住"},
          {k:"I",t:"很會溝通、能帶動、好合作"},
          {k:"S",t:"很可靠、很穩、願意支持"},
          {k:"C",t:"很細、很準、品質很好"}]},
      {q:"當別人跟不上你期待的節奏，你比較常？",
       o:[{k:"D",t:"把里程碑定清楚，要求回報"},
          {k:"I",t:"多說明與鼓舞，讓對方願意動"},
          {k:"S",t:"先降低要求，慢慢把人帶上來"},
          {k:"C",t:"把標準與範例講清楚，減少落差"}]},
      {q:"回顧近期的你，你更像哪一種狀態？",
       o:[{k:"D",t:"推進、定案、把卡點打通"},
          {k:"I",t:"串聯、對齊、讓大家好合作"},
          {k:"S",t:"穩住、陪跑、維持團隊節奏"},
          {k:"C",t:"補洞、控品質、把品質拉起來"}]},
    ]
  },

  love: {
    key: "love",
    name: "感情面向",
    intro: "看你在親密關係裡對安全感、界線、被理解與被尊重的需要，以及你在不安時的保護方式。",
    questions: [
      {q:"當你感覺關係有點不對勁（怪怪的）時，你通常先？",
       o:[{k:"D",t:"直接問清楚，想把狀態拉回來"},
          {k:"I",t:"想先談談感受，希望有互動與回應"},
          {k:"S",t:"先觀察一陣子，避免衝突升高"},
          {k:"C",t:"回想細節與線索，想弄清楚原因"}]},
      {q:"對方情緒很大時，你較常？",
       o:[{k:"D",t:"先把問題框起來：我們要怎麼處理？"},
          {k:"I",t:"先接住情緒：我在，我聽你說"},
          {k:"S",t:"先安撫與陪伴，讓他慢慢穩下來"},
          {k:"C",t:"先釐清事件脈絡，避免誤會擴大"}]},
      {q:"你在感情裡最怕的狀況通常是？",
       o:[{k:"D",t:"對方不負責、問題一直拖"},
          {k:"I",t:"互動冷、沒有回應、像被晾著"},
          {k:"S",t:"衝突頻繁、氣氛緊繃、沒有安穩"},
          {k:"C",t:"說法反覆、標準不一、邏輯對不上"}]},
      {q:"你最容易在關係裡感到安全的是？",
       o:[{k:"D",t:"彼此坦白、說到做到、問題能被處理"},
          {k:"I",t:"有連結、有交流、被在乎"},
          {k:"S",t:"穩定、可預期、彼此溫柔對待"},
          {k:"C",t:"界線清楚、規則一致、彼此尊重"}]},
      {q:"當你受傷或不舒服時，你比較常？",
       o:[{k:"D",t:"先壓住情緒，直接談怎麼改善"},
          {k:"I",t:"希望對方能理解我，想把感受講出來"},
          {k:"S",t:"先忍一下，怕講了關係更不好"},
          {k:"C",t:"反覆想是不是自己哪裡做錯或沒說清楚"}]},
      {q:"你比較常用什麼方式表達在乎？",
       o:[{k:"D",t:"幫你解決、幫你扛、讓你更好"},
          {k:"I",t:"陪你聊、分享、讓你感覺被放在心上"},
          {k:"S",t:"穩定地在、照顧你、讓你有依靠"},
          {k:"C",t:"把細節做好、把承諾做到、讓你放心"}]},
      {q:"當對方跟你的期待不同，你比較常？",
       o:[{k:"D",t:"直接講期待與底線，想要調整"},
          {k:"I",t:"先用比較柔的方式說，怕傷到對方"},
          {k:"S",t:"先退一步，慢慢找合適時機談"},
          {k:"C",t:"列出具體情境與理由，讓對方理解"}]},
      {q:"你在關係裡壓力大時，最可能出現？",
       o:[{k:"D",t:"更想掌控走向，要求立刻處理"},
          {k:"I",t:"更想要回應與確認，怕被忽略"},
          {k:"S",t:"更想維持平和，寧可自己吞"},
          {k:"C",t:"更想確認細節與一致性，避免被反覆"}]},
      {q:"當你覺得對方不理解你時，你比較常冒出的是？",
       o:[{k:"D",t:"那就用行動/結果證明給你看"},
          {k:"I",t:"我需要你聽懂我的感受"},
          {k:"S",t:"我不想吵，先算了"},
          {k:"C",t:"是不是我表達不夠清楚或不夠精準"}]},
      {q:"回顧你在親密關係裡的樣子，你更像？",
       o:[{k:"D",t:"把關係往前推、把問題處理掉的人"},
          {k:"I",t:"把互動做熱、把連結撐住的人"},
          {k:"S",t:"把日常顧好、把安穩維持住的人"},
          {k:"C",t:"把承諾與界線做好、把信任撐住的人"}]},
    ]
  }
};

/** =========================
 * 四型（諮商式語氣：但不使用「諮商式」字眼）
 * ========================= */
const TYPE = {
  D:{
    name:"D（主導）",
    core:"你在這個面向裡，傾向用「推進」來讓自己回到可控。你要的不是贏，而是事情能被處理。",
    protect:"當你感到不確定或卡住，你可能會更直接、更快做決定，這是一種保護自己不要陷進拉扯的方法。",
    need:["明確的下一步與期限","被尊重判斷與權責邊界","對方能回到解法而不是繞圈"],
    practice:["把急轉成可執行：今天先完成哪一步？","用選項句代替催促：你能做A或B？","先暫定再驗證，避免無止盡討論"]
  },
  I:{
    name:"I（影響）",
    core:"你在這個面向裡，傾向用「連結」確認安全感。你要的不是熱鬧，而是被回應、被放在心上。",
    protect:"當互動變冷或不確定，你可能會更想確認、更多表達，這是在保護自己不要被忽略。",
    need:["被回應（哪怕一句）","先理解再處理","互動與情緒被看見"],
    practice:["把想要確認改成具體安排：我們什麼時候談？","先一句結論再補感受，對方更接得住","用『我需要…』代替『你都…』"]
  },
  S:{
    name:"S（穩定）",
    core:"你在這個面向裡，傾向用「安穩」維持關係與節奏。你要的不是不變，而是能夠預期、能慢慢來。",
    protect:"當環境變動或衝突升高，你可能先忍、先緩，這是在保護關係也保護自己不被拉扯。",
    need:["緩衝與預告","溫和但清楚的界線","被體諒節奏與壓力"],
    practice:["提早小表態：我需要一點時間/我希望提前一天知道","把界線說成照顧合作：這樣我比較跟得上","每次只說一個需求，避免一次講太重"]
  },
  C:{
    name:"C（謹慎）",
    core:"你在這個面向裡，傾向用「標準與一致」降低不確定。你要的不是挑剔，而是避免之後更大的反覆成本。",
    protect:"當標準不清或資訊不足，你可能會更想確認細節、反覆檢查，這是在保護自己不要踩雷。",
    need:["清楚定義與完成標準","可驗證的依據與範圍","一致性與可追蹤"],
    practice:["先暫定結論＋驗證清單：出現B就調整","必要標準先訂3條，其餘允許彈性","用檢核表取代腦內反覆推演"]
  }
};

/** =========================
 * 12種主輔型（DI vs ID 需不同）
 * - 這裡用「複習＋分析」結構：看到的模式→可能的內在動機→容易卡住的點→一個小練習
 * ========================= */
const COMBO = {
  DI:{title:"DI（主D／輔I）",review:["你先抓方向、先推進（D），再用互動把人帶上來（I）。","你會把『人願不願意跟』放進結果的一部分。"],analysis:["你內在常在做兩件事：一邊清卡點、一邊確認連結有沒有斷。","壓力大時，你可能更直、更快；對方感受到的是壓迫，而你在做的是『把局勢拉回可控』。"],stuck:["別人情緒卡住／回應慢，你會更想推；推得越快，對方越退。"],practice:"先用一句話把關係放回同一邊：『我想推進，也想顧到你。我們先定A，覺得不舒服的地方再一起調整。』"},
  DS:{title:"DS（主D／輔S）",review:["你要推進（D），也很在意承受度與穩定（S）。","你不想拖，但也不想讓人被壓垮。"],analysis:["你常把壓力轉成責任自己扛：只要我推快一點，就能護住大局。","你看似強勢，內在其實有一塊很在乎『不要傷到關係』。"],stuck:["你可能忍著不說需求，最後用更強的推進補回時間，反而更累。"],practice:"把速度放進流程：先拆里程碑＋回報節點，讓推進不靠催促。"},
  DC:{title:"DC（主D／輔C）",review:["你先推進定方向（D），接著用標準把品質與風險收斂（C）。","你要的是『快』但也要『不留後遺症』。"],analysis:["你會用決斷保護效率，再用規格保護結果。","壓力大時可能變得又快又嚴，因為你在避免之後反覆更耗。"],stuck:["你容易對「不清楚」敏感，會想立刻定案；但定太快又會回頭補很多。"],practice:"用『暫定結論＋驗證條件』：先走A，若出現B就調整。"},
  ID:{title:"ID（主I／輔D）",review:["你先把互動拉回來（I），再推進行動（D）。","你擅長讓人願意動，也敢在關鍵時刻做決定。"],analysis:["你用連結降低不安，用推進給自己安全感。","壓力大時你會很需要回應；一旦拿不到回應，就會從柔轉硬，開始推。"],stuck:["你容易把『需要回應』變成『一直確認』，對方會覺得被追。"],practice:"把確認變安排：『我需要知道你怎麼想，我們今晚9點聊10分鐘可以嗎？』"},
  IS:{title:"IS（主I／輔S）",review:["你要連結（I），也要舒服與安穩（S）。","你很會顧氣氛，也很會顧人的承受度。"],analysis:["你常用溫柔維持關係，但也容易把需求收起來。","壓力大時你會更在意回應，但又不想造成壓力，所以會更內耗。"],stuck:["你可能一直撐互動，卻不敢說你要什麼，最後感覺失衡。"],practice:"把感受翻成一個很小的請求：『我希望你今天回我一句就好。』"},
  IC:{title:"IC（主I／輔C）",review:["你要被理解（I），也要被正確理解（C）。","你會補細節，是因為你怕誤會造成更遠的距離。"],analysis:["你內在很在意『我講清楚了嗎？他真的懂嗎？』","壓力大時你會越講越多，想用完整保護連結。"],stuck:["對方接不住細節時，你會更失落，覺得被敷衍。"],practice:"先一句結論＋兩個重點，再問：『你理解到哪裡？』把對齊放在前面。"},
  SD:{title:"SD（主S／輔D）",review:["你先穩住節奏（S），必要時也能扛起推進（D）。","你通常先顧和氣，但不是沒有立場。"],analysis:["你用穩定保護關係；但當穩定被破壞太久，你會用推進把局勢拉回來。","這種切換有力量，但也容易讓你被誤會成『突然很兇』。"],stuck:["你忍太久才說，導致一次說太重。"],practice:"提早說10%的需求：『我需要提前一天知道變更。』"},
  SI:{title:"SI（主S／輔I）",review:["你要安穩（S），也在意互動的溫度（I）。","你很會照顧人，也很願意配合。"],analysis:["你常把『不要讓關係不舒服』放在第一位。","壓力大時你會更吞、更安撫，但內在其實很需要一句回應。"],stuck:["你把需求放太後面，久了容易委屈或突然疏遠。"],practice:"先肯定再請求：『我知道你忙，但我希望你今晚回我一句，讓我安心。』"},
  SC:{title:"SC（主S／輔C）",review:["你要安穩（S），也要規則一致（C）。","你追求的是可預期：事情不要一直變、標準不要一直改。"],analysis:["你會默默把混亂整理好，因為你不想讓人更辛苦。","壓力大時你容易把責任往內收，變得更緊繃。"],stuck:["你不說標準，別人就照自己方式做，你只好一直補洞。"],practice:"先講3條必要標準：完成定義、期限、回報格式。"},
  CD:{title:"CD（主C／輔D）",review:["你先求正確（C），一旦清楚就推很快（D）。","你不是慢，你是在把風險算完。"],analysis:["你用標準保護成果，用推進保護效率。","壓力大時你會更想核對；外界催快會讓你更慢，因為你更怕踩雷。"],stuck:["你缺資訊卻又被要答案，容易焦躁或乾脆關閉溝通。"],practice:"一句話交代：『我缺X資料，拿到後我在Y小時內給結論。』"},
  CI:{title:"CI（主C／輔I）",review:["你重一致與正確（C），也在意互動是否被公平理解（I）。","你補充脈絡，是為了避免被誤解成你不在乎。"],analysis:["你在守的是信任：說到做到、標準一致。","壓力大時你會更想解釋清楚，也更需要對方認真聽。"],stuck:["對方越隨便，你越想講清楚；你越講，對方越想逃。"],practice:"用例子取代長解釋：『上次X讓我不安，所以我需要Y標準。』"},
  CS:{title:"CS（主C／輔S）",review:["你重標準（C），也重穩定與體諒（S）。","你會把事做對，也會把人顧好。"],analysis:["你常把責任與關係一起扛，所以很可靠，但也最容易累。","壓力大時你會更想補洞，因為你不想造成別人的麻煩。"],stuck:["你一直補，別人就學不會；你越累越想放棄。"],practice:"把照顧變制度：訂回報格式＋完成定義，讓你不用一直救火。"},
};

/** =========================
 * 單一面向作答狀態（不共享）
 * ========================= */
let currentKey = null;         // 'life' | 'work' | 'love'
let qIndex = 0;
let scores = {D:0,I:0,S:0,C:0};

const $ = (id)=>document.getElementById(id);

function pct(v,total){ return total===0 ? 0 : Math.round((v/total)*100); }

function resetSection(){
  qIndex = 0;
  scores = {D:0,I:0,S:0,C:0};
  $("result").innerHTML = "";
  renderQuestion();
}

function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, s => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
  }[s]));
}

function sortedScores(scoreObj){
  const arr = Object.entries(scoreObj).map(([k,v])=>({k,v}));
  arr.sort((a,b)=>b.v-a.v);
  return arr;
}

function classify(scoreObj){
  const arr = sortedScores(scoreObj);
  const max = arr[0].v;
  const second = arr.find(x=>x.v < max)?.v ?? max;
  const primary = arr.filter(x=>x.v===max).map(x=>x.k);
  const secondary = arr.filter(x=>x.v===second && !primary.includes(x.k)).map(x=>x.k);
  return {arr,max,second,primary,secondary};
}

function getCombo(primary, secondary){
  if(primary.length===1 && secondary.length===1){
    const key = `${primary[0]}${secondary[0]}`; // 注意大小寫固定
    return COMBO[key] || null;
  }
  return null;
}

function buildResult(){
  const total = Object.values(scores).reduce((a,b)=>a+b,0);
  const {arr,primary,secondary} = classify(scores);

  const pText = primary.length===1 ? TYPE[primary[0]].name : `並列主型：${primary.map(k=>TYPE[k].name).join("、")}`;
  const sText = secondary.length===1 ? TYPE[secondary[0]].name : (secondary.length ? `並列輔型：${secondary.map(k=>TYPE[k].name).join("、")}` : "輔型不明顯（分數接近）");

  const combo = getCombo(primary, secondary);

  // 主型敘述（取第一個主型代表）
  const mainKey = primary[0];
  const main = TYPE[mainKey];

  let comboHtml = "";
  if(combo){
    comboHtml = `
      <div class="box" style="margin-top:12px">
        <h2 style="margin-top:0">複習</h2>
        <ul>${combo.review.map(x=>`<li>${x}</li>`).join("")}</ul>
        <h2>分析</h2>
        <ul>${combo.analysis.map(x=>`<li>${x}</li>`).join("")}</ul>
        <h2>容易卡住的地方</h2>
        <ul><li>${combo.stuck}</li></ul>
        <h2>一個小練習</h2>
        <p class="small" style="color:var(--text)">${combo.practice}</p>
      </div>
    `;
  } else {
    // 沒有明顯主輔型（並列/接近）
    comboHtml = `
      <div class="box" style="margin-top:12px">
        <h2 style="margin-top:0">複習與分析</h2>
        <p>你的分數呈現比較接近或並列，表示你在這個面向會「看情境切換策略」。這不是不穩定，而是工具比較多。</p>
        <ul>
          <li>先留意：在壓力上來時，你最先跳出來的反應是哪一個？（推進／連結／安穩／標準）</li>
          <li>再留意：你用哪一個方式把自己拉回來？（通常就是你的次要策略）</li>
        </ul>
      </div>
    `;
  }

  return `
    <div class="box">
      <h2 style="margin-top:0">結果</h2>
      <div class="tag">主型：<b style="color:var(--text)">${pText}</b></div>
      <div class="tag">輔型：<b style="color:var(--text)">${sText}</b></div>

      <h2>分數分布</h2>
      <table class="table">
        <thead><tr><th>向度</th><th>分數</th><th>比例</th></tr></thead>
        <tbody>
          ${arr.map(x=>`
            <tr>
              <td>${TYPE[x.k].name}</td>
              <td>${x.v}</td>
              <td>${pct(x.v,total)}%</td>
            </tr>
          `).join("")}
        </tbody>
      </table>

      <div class="box" style="margin-top:12px">
        <h2 style="margin-top:0">主型核心</h2>
        <p><b>${main.name}</b></p>
        <ul>
          <li>${main.core}</li>
          <li>${main.protect}</li>
        </ul>
        <h2>你可能需要的支持</h2>
        <ul>${main.need.map(x=>`<li>${x}</li>`).join("")}</ul>
        <h2>你可以嘗試的調整</h2>
        <ul>${main.practice.map(x=>`<li>${x}</li>`).join("")}</ul>
      </div>

      ${comboHtml}
    </div>
  `;
}

function start(key){
  currentKey = key;
  $("menu").style.display = "none";
  $("testArea").style.display = "block";
  $("subtitle").textContent = BANK[key].intro;
  $("sectionPill").innerHTML = `<b style="color:var(--accent)">${BANK[key].name}</b>`;
  resetSection();
}

function goHome(){
  currentKey = null;
  $("menu").style.display = "grid";
  $("testArea").style.display = "none";
  $("subtitle").textContent = "選一個面向開始作答（各 10 題）。每個面向的作答與結果彼此獨立。";
  $("result").innerHTML = "";
}

function renderMenu(){
  $("menu").innerHTML = `
    <button onclick="start('life')">
      <b style="color:var(--accent)">開始：生活面向</b><br/>
      <span class="small">${escapeHtml(BANK.life.intro)}</span>
    </button>
    <button onclick="start('work')">
      <b style="color:var(--accent)">開始：工作面向</b><br/>
      <span class="small">${escapeHtml(BANK.work.intro)}</span>
    </button>
    <button onclick="start('love')">
      <b style="color:var(--accent)">開始：感情面向</b><br/>
      <span class="small">${escapeHtml(BANK.love.intro)}</span>
    </button>
  `;
}

function renderQuestion(){
  const sec = BANK[currentKey];
  $("qPill").innerHTML = `<b style="color:var(--accent)">第 ${Math.min(qIndex+1, sec.questions.length)} / ${sec.questions.length} 題</b>`;
  $("backBtn").disabled = qIndex === 0;

  // 完成後：立即顯示結果（不顯示作答紀錄）
  if(qIndex >= sec.questions.length){
    $("question").textContent = "已完成（已產出結果）";
    $("options").innerHTML = "";
    $("result").innerHTML = buildResult();
    return;
  }

  const q = sec.questions[qIndex];
  $("question").textContent = q.q;

  const box = $("options");
  box.innerHTML = "";
  q.o.forEach((opt,i)=>{
    const b = document.createElement("button");
    b.innerHTML = `<b style="color:var(--accent)">(${String.fromCharCode(65+i)})</b> ${escapeHtml(opt.t)}`;
    b.onclick = ()=>pick(opt);
    box.appendChild(b);
  });
}

function pick(opt){
  scores[opt.k] += 1;
  qIndex += 1;
  renderQuestion();
}

function back(){
  if(qIndex === 0) return;
  // 因為沒記錄每題選項，退回只能用「重新作此面向」更安全
  // 這裡改成：提示並要求重新作（避免分數錯亂）
  alert("此版本不保留每題作答紀錄，若要回上一題請改用「重作此面向」以避免結果不準。");
}

$("backBtn").addEventListener("click", back);
$("restartBtn").addEventListener("click", resetSection);
$("homeBtn").addEventListener("click", goHome);
window.start = start;

// init
renderMenu();
goHome();
</script>
</body>
</html>
