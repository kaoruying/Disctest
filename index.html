<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DISC測驗</title>
  <style>
    :root{
      --bg:#0b1220; --card:#121b2e; --line:#24304c;
      --text:#e9eefc; --muted:#b7c0da;
      --btn:#1e2a46; --btn2:#2b3a6b;
      --accent:#7aa2ff; --soft:#0e1630; --chip:#0f1a38;
      --ok:#56d364; --warn:#ffcc66;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:"Noto Sans TC","Microsoft JhengHei",system-ui,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px}
    h1{margin:0 0 8px;font-size:22px}
    h2{margin:14px 0 8px;font-size:18px}
    h3{margin:12px 0 6px;font-size:16px}
    p{margin:8px 0;line-height:1.75;color:var(--muted)}
    .small{font-size:13px;color:var(--muted)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;color:var(--muted);background:rgba(255,255,255,.02)}
    .q{font-size:18px;color:var(--text);margin-top:14px}
    .opts{margin-top:10px;display:grid;gap:10px}
    button{
      width:100%;text-align:left;padding:14px;border-radius:12px;border:1px solid var(--line);
      background:var(--btn);color:var(--text);font-size:16px;cursor:pointer
    }
    button:hover{background:var(--btn2)}
    button.secondary{background:transparent;color:var(--muted)}
    button.secondary:hover{background:var(--soft)}
    button.smallBtn{padding:10px 12px;font-size:14px}
    .footer{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:6px 10px;margin:6px 6px 0 0;color:var(--muted);font-size:13px;background:rgba(255,255,255,.02)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:760px){.grid{grid-template-columns:1fr}}
    .box{background:var(--soft);border:1px solid var(--line);border-radius:16px;padding:14px}
    .menuGrid{display:grid;gap:10px;margin-top:10px}
    .quote{
      margin-top:10px; padding:10px 12px; border-radius:14px;
      border:1px dashed var(--line); background:rgba(122,162,255,0.08); color:var(--text);
      line-height:1.75
    }
    details{background:rgba(255,255,255,.02);border:1px solid var(--line);border-radius:16px;padding:12px;margin-top:10px}
    summary{cursor:pointer;font-weight:700;color:var(--text)}
    ul{margin:8px 0 0 18px;color:var(--text);line-height:1.75}
    li{margin:6px 0}
    .table{width:100%;border-collapse:collapse;margin-top:8px}
    .table th,.table td{border-bottom:1px solid var(--line);padding:10px 6px;text-align:left}
    .divider{height:1px;background:var(--line);margin:12px 0}
    .badge{display:inline-block;padding:3px 8px;border-radius:999px;border:1px solid var(--line);font-size:12px;margin-left:6px;color:var(--muted)}
    .ok{border-color:rgba(86,211,100,.4); color:var(--ok)}
    .warn{border-color:rgba(255,204,102,.4); color:var(--warn)}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>DISC測驗</h1>
    <p class="small" id="subtitle">選一個面向開始作答（各 12 題）。每個面向獨立作業，完成就立刻出結果。</p>

    <!-- 首頁選單 -->
    <div id="menu" class="menuGrid"></div>

    <!-- 作答區 -->
    <div id="testArea" style="display:none">
      <div class="row" style="margin-top:10px">
        <span class="pill" id="sectionPill"></span>
        <span class="pill" id="qPill"></span>
      </div>

      <div class="q" id="question"></div>
      <div class="opts" id="options"></div>

      <div class="footer">
        <button class="secondary smallBtn" id="restartBtn">重作此面向</button>
        <button class="secondary smallBtn" id="homeBtn">回首頁</button>
      </div>

      <div id="result" style="margin-top:14px"></div>
    </div>
  </div>
</div>

<script>
/* =========================================================
   0) 小工具：洗牌（每題選項顯示亂序，避免被猜 D/I/S/C）
   ========================================================= */
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}
function pct(v,total){ return total===0 ? 0 : Math.round((v/total)*100); }

/* =========================================================
   1) 題庫：三面向各 12 題（口語化）
   - 每題四個選項都帶 k: D/I/S/C 但不顯示
   - 顯示時每題亂序，A/B/C/D 標示
   ========================================================= */
const BANK = {
  life: {
    key:"life",
    name:"生活面向",
    intro:"日常版本的你：遇到插隊、變動、人際互動時，你會怎麼反應。",
    questions:[
      {q:"行程突然改掉（臨時延期/換地點），你第一反應最像？",
        o:[{k:"S",t:"先讓自己穩一下，照原本節奏慢慢調整"},
           {k:"C",t:"先問清楚原因和限制，再決定要怎麼改"},
           {k:"I",t:"先跟相關的人講一下、對一下狀況"},
           {k:"D",t:"直接改計畫，立刻把下一步排出來"}]},
      {q:"你要買一個不便宜的東西（手機/課程/家電），你比較像？",
        o:[{k:"I",t:"看喜不喜歡、用起來心情好不好"},
           {k:"C",t:"研究規格、比較評價到很確定"},
           {k:"D",t:"看值不值得，能不能馬上解決需求"},
           {k:"S",t:"看是不是耐用、穩、對家裡友善"}]},
      {q:"朋友抱怨一大串，你最自然的回法是？",
        o:[{k:"C",t:"你先把事情講清楚：發生什麼、你要什麼？"},
           {k:"I",t:"我懂…你先說，我在"},
           {k:"D",t:"好，那我們現在怎麼處理？我幫你拆步驟"},
           {k:"S",t:"先別急，慢慢來，我陪你"}]},
      {q:"你最受不了的日常狀況通常是？",
        o:[{k:"S",t:"一直吵、一直衝突，整個很不安穩"},
           {k:"D",t:"拖拖拉拉、講半天都沒進度"},
           {k:"C",t:"規則一直變、標準不一、很難配合"},
           {k:"I",t:"大家都悶著不講，氣氛很冷"}]},
      {q:"你壓力很大、很累時，你比較像？",
        o:[{k:"D",t:"先把最重要的事情清掉，讓自己喘一口氣"},
           {k:"S",t:"降低刺激，回到熟悉節奏，慢慢恢復"},
           {k:"I",t:"想找人聊一下，不然心裡悶著更累"},
           {k:"C",t:"一直整理/檢查，讓混亂變得可控"}]},
      {q:"別人答應你的事又沒做到，你比較常怎麼做？",
        o:[{k:"I",t:"用比較不傷人的方式提醒，怕對方有壓力"},
           {k:"C",t:"問原因，順便把規則/責任講清楚"},
           {k:"D",t:"直接問：那你什麼時候會完成？"},
           {k:"S",t:"先忍一下，等時機比較好再說"}]},
      {q:"你做生活大決定（搬家/買車/換工作）時，你最在意？",
        o:[{k:"S",t:"穩不穩、會不會影響家人和日常"},
           {k:"D",t:"能不能讓生活更有效率、問題更少"},
           {k:"I",t:"我喜不喜歡、會不會更開心"},
           {k:"C",t:"資訊夠不夠、風險能不能算清楚"}]},
      {q:"你最容易變急，是什麼情境？",
        o:[{k:"C",t:"標準不清楚卻要我負責結果"},
           {k:"I",t:"大家不講清楚，誤會一直累積"},
           {k:"D",t:"我看得到路了，但大家就是不動"},
           {k:"S",t:"節奏一直變，我跟不上也沒人先說"}]},
      {q:"別人請你幫忙，你最常提供的是？",
        o:[{k:"S",t:"陪你一起做完，不讓你一個人扛"},
           {k:"D",t:"直接幫你把事情搞定，往前推"},
           {k:"C",t:"整理方法、步驟、注意事項給你"},
           {k:"I",t:"陪你想方法，也幫你加油"}]},
      {q:"你心裡最想要的生活感受是？",
        o:[{k:"I",t:"有人懂我、有人回應我"},
           {k:"C",t:"規則清楚、事情可預期"},
           {k:"S",t:"穩穩的、不要太多衝突"},
           {k:"D",t:"事情在動、我在掌握中"}]},
      {q:"如果有人說『你最近變了』，你通常是變成？",
        o:[{k:"D",t:"更快、更直接、更想把事情定下來"},
           {k:"S",t:"比較安靜，想把自己穩住"},
           {k:"I",t:"比較需要回應，會更想確認關係"},
           {k:"C",t:"更在意細節，怕出錯"}]},
      {q:"回想最近的你，在日常裡更像哪一種狀態？",
        o:[{k:"C",t:"我在補細節、控品質、避免出錯"},
           {k:"D",t:"我在推動前進、把卡點清掉"},
           {k:"S",t:"我在穩住生活、顧好日常"},
           {k:"I",t:"我在撐互動、讓關係好溝通"}]},
    ]
  },

  work: {
    key:"work",
    name:"工作面向",
    intro:"工作版本的你：遇到壓力、合作、變動、被挑戰時，你會怎麼跑。",
    questions:[
      {q:"急件來了但資訊不全，你通常先？",
        o:[{k:"C",t:"先補資料和風險，不然我不敢亂走"},
           {k:"D",t:"先做可逆決策，推進再修正"},
           {k:"I",t:"先找關鍵人對齊，讓大家同頻"},
           {k:"S",t:"先穩住既有進度，避免牽連更多人"}]},
      {q:"開會開很久沒結論，你通常會？",
        o:[{k:"I",t:"提問拉共識，讓大家願意選"},
           {k:"C",t:"把標準拉出來：到底怎樣才算完成？"},
           {k:"D",t:"收斂選項，直接定下一步"},
           {k:"S",t:"先聽各方，避免衝突升高"}]},
      {q:"你最受不了的合作狀況是？",
        o:[{k:"D",t:"拖、推不動、沒人承擔"},
           {k:"S",t:"變動太快、一直逼，氣氛緊張"},
           {k:"I",t:"合作冷、互動差、很難好好講"},
           {k:"C",t:"標準不清、一直改、品質粗糙"}]},
      {q:"你帶人/協作時，你心裡最在意？",
        o:[{k:"S",t:"節奏要穩，別讓人壓力爆掉"},
           {k:"D",t:"權責要清楚、要能推進結果"},
           {k:"C",t:"流程要一致、可追蹤可複製"},
           {k:"I",t:"動機要在，人才願意跟"}]},
      {q:"被質疑/挑戰時，你比較常怎麼回？",
        o:[{k:"C",t:"拿依據、邏輯、脈絡把它釐清"},
           {k:"S",t:"先退一步，避免硬碰硬"},
           {k:"D",t:"回到目標與成效，談結果"},
           {k:"I",t:"先看對方狀態，調整說法"}]},
      {q:"壓力一大，你最像？",
        o:[{k:"I",t:"更在意回應與認同，想把互動顧住"},
           {k:"D",t:"更快、更直接、更想立刻定案"},
           {k:"C",t:"更想把標準釐清，反覆檢查避免錯"},
           {k:"S",t:"更想維持穩定，先把壓力吞下來"}]},
      {q:"你做決策最靠的是？",
        o:[{k:"D",t:"時效與影響力：先定方向比較重要"},
           {k:"C",t:"資料與可驗證：先確認正確"},
           {k:"S",t:"風險與穩定：先確保不翻車"},
           {k:"I",t:"團隊與回饋：先確定大家能一起走"}]},
      {q:"你最常被稱讚的工作特質是？",
        o:[{k:"C",t:"細、準、品質好"},
           {k:"I",t:"會溝通、能帶動"},
           {k:"S",t:"可靠、穩、能陪跑"},
           {k:"D",t:"有效率、敢決斷、扛得住"}]},
      {q:"別人跟不上你的節奏，你比較常？",
        o:[{k:"S",t:"先降低要求，慢慢把人帶上來"},
           {k:"C",t:"把標準和範例講清楚，減少落差"},
           {k:"D",t:"把里程碑定好，要求回報"},
           {k:"I",t:"多說明與鼓舞，讓對方願意動"}]},
      {q:"你比較像哪種同事？",
        o:[{k:"I",t:"把大家連起來，讓合作順"},
           {k:"D",t:"把事情推進到完成"},
           {k:"S",t:"把節奏穩住，不讓人崩"},
           {k:"C",t:"把標準顧好，避免重工"}]},
      {q:"你最怕的是？",
        o:[{k:"C",t:"做了半天方向錯，後面全重來"},
           {k:"S",t:"氣氛太緊，最後都不想合作"},
           {k:"I",t:"大家不說真話，只剩表面配合"},
           {k:"D",t:"機會來了卻不推，拖到錯過"}]},
      {q:"回顧近期工作狀態，你更像？",
        o:[{k:"D",t:"推進、定案、把卡點打通"},
           {k:"I",t:"串聯、對齊、讓大家好合作"},
           {k:"C",t:"補洞、控標準、把品質拉起來"},
           {k:"S",t:"穩住、陪跑、維持團隊節奏"}]},
    ]
  },

  love: {
    key:"love",
    name:"感情面向",
    intro:"親密關係版本的你：你在乎什麼、怕什麼、需要怎樣的對待才會安心。",
    questions:[
      {q:"你覺得關係怪怪的時，你通常先？",
        o:[{k:"I",t:"想先談談感受，希望對方回應"},
           {k:"C",t:"回想細節，想弄清楚原因"},
           {k:"S",t:"先觀察一下，避免衝突變大"},
           {k:"D",t:"直接問清楚，想把狀態拉回來"}]},
      {q:"對方情緒很大時，你比較常？",
        o:[{k:"S",t:"先安撫和陪伴，讓他慢慢穩下來"},
           {k:"D",t:"先把問題框起來：那我們要怎麼處理？"},
           {k:"I",t:"先接住：我在，你先說"},
           {k:"C",t:"先釐清發生什麼，避免越吵越誤會"}]},
      {q:"你在感情裡最怕的是？",
        o:[{k:"D",t:"問題一直拖，對方不負責"},
           {k:"I",t:"互動冷，像被晾著"},
           {k:"C",t:"說法反覆、標準不一、邏輯對不上"},
           {k:"S",t:"衝突太多，沒有安穩感"}]},
      {q:"你最容易覺得安心的是？",
        o:[{k:"C",t:"界線清楚、規則一致、互相尊重"},
           {k:"S",t:"穩定可預期、彼此溫柔對待"},
           {k:"I",t:"有連結、有交流、被在乎"},
           {k:"D",t:"說到做到、問題能被處理"}]},
      {q:"你受傷或不舒服時，你比較常？",
        o:[{k:"C",t:"一直想：是不是我哪裡講錯、做錯"},
           {k:"S",t:"先忍一下，怕講了更糟"},
           {k:"I",t:"想把感受說出來，希望對方理解"},
           {k:"D",t:"想直接談：以後怎麼改善"}]},
      {q:"你表達在乎比較像？",
        o:[{k:"I",t:"陪你聊、分享、讓你覺得被放在心上"},
           {k:"D",t:"幫你解決、幫你扛、讓你更好"},
           {k:"S",t:"穩定地在、照顧你、讓你有依靠"},
           {k:"C",t:"把細節做好、把承諾做到、讓你放心"}]},
      {q:"對方跟你期待不同時，你比較常？",
        o:[{k:"D",t:"直接講底線和期待，想調整"},
           {k:"S",t:"先退一步，找時機再談"},
           {k:"C",t:"用具體例子講清楚原因"},
           {k:"I",t:"用比較柔的方式說，怕傷到對方"}]},
      {q:"關係壓力變大時，你最可能變成？",
        o:[{k:"S",t:"更想維持平和，寧可自己吞"},
           {k:"I",t:"更需要確認和回應，怕被忽略"},
           {k:"C",t:"更想確認一致性，避免被反覆"},
           {k:"D",t:"更想掌控走向，要求立刻處理"}]},
      {q:"你覺得對方不理解你時，你腦中比較像？",
        o:[{k:"I",t:"我需要你聽懂我的感受"},
           {k:"D",t:"那我用行動/結果證明給你看"},
           {k:"S",t:"我不想吵，先算了"},
           {k:"C",t:"是不是我表達不夠清楚"}]},
      {q:"你比較受不了哪一種溝通？",
        o:[{k:"C",t:"說法一直改，前後矛盾"},
           {k:"I",t:"冷處理、已讀不回"},
           {k:"S",t:"大吵大鬧、情緒勒索"},
           {k:"D",t:"講一堆但不處理問題"}]},
      {q:"你想要的陪伴比較像？",
        o:[{k:"S",t:"穩穩在，不用很多話也安心"},
           {k:"I",t:"多交流、多互動、有來有往"},
           {k:"C",t:"清楚說好規則和界線，彼此更放心"},
           {k:"D",t:"一起把問題處理掉，往更好方向走"}]},
      {q:"回顧你在關係裡的樣子，你更像？",
        o:[{k:"D",t:"把關係往前推、把問題處理掉的人"},
           {k:"S",t:"把日常顧好、把安穩維持住的人"},
           {k:"I",t:"把互動做熱、把連結撐住的人"},
           {k:"C",t:"把承諾與界線做好、把信任撐住的人"}]},
    ]
  }
};

/* =========================================================
   2) 解析資料：主型四段＋可截圖模組＋三面向微調＋12組複型
   ========================================================= */
const TYPE_MAIN = {
  D:{
    title:"D 型｜推進／掌控／有效",
    care:[
      "有沒有進度、能不能往前、事情是不是『正在被處理』",
      "誰負責、什麼時候交、能不能定下一步（比感受更在意推進）",
      "速度與影響力：做這件事值不值得、能不能改變局面"
    ],
    fear:["失控、被拖累、浪費時間","問題明明在眼前，卻沒人動"],
    stress:["更直接、更急、更想立刻定案","容忍度下降：聽到理由先覺得像藉口"],
    want:["先講結論＋下一步，不要只講感受","給選項：A 或 B、現在做哪個最有效","給時間點：什麼時候回覆、什麼時候完成"],
    hook:"「你不是沒耐性，你是對『卡住』特別敏感。」",
    module:{
      anxiety:["變很快、很直接、很想立刻定案","把『推進』當成唯一解法","心裡其實在想：再不動就來不及了"],
      misread:["以為你很兇、很沒耐性","以為你不在乎感受、只在乎結果","以為你在下命令，其實你只是很急"],
      line:"「我知道你很急，我也想往前。這是我現在能做到的下一步。」"
    }
  },
  I:{
    title:"I 型｜連結／回應／被看見",
    care:[
      "有沒有互動、有沒有回應、氣氛是不是有溫度",
      "自己是不是被放在心上、關係有沒有被維持",
      "過程中的認同：你有沒有理解我、你在不在乎我"
    ],
    fear:["冷淡、被忽略、被當成不重要","我講了，你卻沒反應（會直接拉高不安）"],
    stress:["更想確認、更想問『你到底怎麼想』","話變多、訊息變密，想把對方拉回來"],
    want:["先回應再解決：一句『我有聽到』就能讓他穩","明確回覆節奏：做不到也說『我何時能回你』","用人味講話：不要只丟結論，補一句感受更有效"],
    hook:"「你要的不是答案，你要的是回應。」",
    module:{
      anxiety:["很想確認、很想講清楚感受","訊息變密、一直想把對方拉回來","心裡其實在想：你還在不在？"],
      misread:["以為你很黏、很需要關注","以為你在情緒化、在盧","其實你是在找回連結"],
      line:"「我有聽到你在意的點，我現在在。」"
    }
  },
  S:{
    title:"S 型｜安穩／一致／不要傷到人",
    care:[
      "穩定、可預期、節奏不要被打爆",
      "關係和諧、不要衝突、不要讓人難堪",
      "可靠與持續：能不能長期走下去，而不是一時衝很快"
    ],
    fear:["突然變動、逼迫、情緒爆衝","我跟不上、或被要求立刻改變"],
    stress:["先吞、先忍、先配合","越累越沉默，最後才一次爆出來（容易被誤會突然翻臉）"],
    want:["給緩衝：先講『為什麼要變』＋『你可以怎麼做』","溫和但清楚的界線（不需要兇，但要清楚）","讓他有時間適應，而不是立刻上強度"],
    hook:"「你不是沒想法，你是不想把場面弄難看。」",
    module:{
      anxiety:["先忍、先吞、先配合","把衝突往後放，把穩定放前面","心裡其實在想：不要讓事情更糟"],
      misread:["以為你沒意見、沒想法","以為你都 OK、都可以","其實你在撐"],
      line:"「不用急著答應，你可以慢慢來，我等你。」"
    }
  },
  C:{
    title:"C 型｜正確／標準／可控",
    care:[
      "定義清楚、標準一致、事情不要反覆重來",
      "資訊完整、邏輯合理、風險可控",
      "品質與可信度：做出來要站得住"
    ],
    fear:["模糊、亂、在不確定下被要求承諾","你叫我快，但你給的條件不完整"],
    stress:["反覆確認、過度檢查、腦停不下來","對瑕疵更敏感、容易變挑（其實是在自保）"],
    want:["先講清楚：完成定義、達標條件","給依據：為什麼這樣做、風險怎麼控","允許先釐清再承諾：不要逼『現在就說一定』"],
    hook:"「你不是龜毛，你是在保護結果不要翻車。」",
    module:{
      anxiety:["一直想確認、一直補細節","反覆檢查、反覆思考","心裡其實在想：這樣真的對嗎？"],
      misread:["以為你龜毛、很難搞","以為你不信任人","其實你在避開風險"],
      line:"「完成的標準是這三點，其他的我們之後再修。」"
    }
  }
};

const CONTEXTS = {
  life:{
    title:"生活面向（比較日常）",
    bullets:{
      D:"我想把日子過順，不要一直卡。",
      I:"我希望家裡/朋友是有溫度、有互動的。",
      S:"我想要穩定規律，不要太多波動。",
      C:"我想把生活整理好，避免出錯跟反覆。"
    }
  },
  work:{
    title:"工作面向（比較任務與責任）",
    bullets:{
      D:"我要結果、要推進、要負責。",
      I:"我要合作順、願意跟、溝通有效。",
      S:"我要團隊節奏穩，不要內耗。",
      C:"我要品質、標準、風險可控。"
    }
  },
  love:{
    title:"感情面向（比較安全感與界線）",
    bullets:{
      D:"我希望問題能被處理，不要拖。",
      I:"我需要回應，需要被在乎。",
      S:"我需要安穩，不想一直衝突。",
      C:"我需要一致與清楚，才會放心信任。"
    }
  }
};

// 12 組主＋副型（每組不同）
const COMBO = {
  DI:{t:"DI（主D／副I）", out:"推進、定案、拉速度，同時也會顧到『大家跟不跟得上』。", inner:"你要的不只是快，是『一起快』；你想把人拉回同一邊再往前。", stress:"更直、更快，容易被感覺像在催；其實你只是怕卡住、怕錯過。", tip:"先給下一步＋時間點，再談細節。", line:"我也想往前，我現在能做到的下一步是＿＿＿。"},
  ID:{t:"ID（主I／副D）", out:"先連結、先對齊；對齊後行動力很強。", inner:"你需要先確定『我們是同一邊』，才敢全力推進。", stress:"一沒回應就會從溫柔變急，想立刻談清楚。", tip:"先回應一句『我有聽到』，你就更願意往前。", line:"我在，我有聽到，我們現在來定下一步。"},
  DS:{t:"DS（主D／副S）", out:"敢扛、敢推，但不喜歡把人壓垮。", inner:"你推得快常是為了保護整體不失控；你要的是可持續的前進。", stress:"表面更硬，內心更怕失控；會默默扛到很累。", tip:"用里程碑＋回報點保速度，推進不用靠催。", line:"我會跟上，但我們先把節奏訂清楚。"},
  SD:{t:"SD（主S／副D）", out:"先穩住局面；該推時會突然變得很堅定。", inner:"你在守和氣與節奏，也在守『不要一直拖』。", stress:"忍到最後一次講很重，容易被誤會突然翻臉。", tip:"提早講10%的需求，不要等到80%才爆。", line:"你的底線是什麼？我想提早知道、一起顧好。"},
  DC:{t:"DC（主D／副C）", out:"快、決斷，同時對標準很在意。", inner:"你追的是『快＋不留後遺症』；你最怕重工翻車。", stress:"又快又嚴，對模糊特別不耐。", tip:"給暫定結論＋驗證條件，你就能往前走。", line:"先走A；如果出現B，我們就調整。"},
  CD:{t:"CD（主C／副D）", out:"先確認正確；一旦確定，你推很快。", inner:"你在守『不要出錯、不要翻車』；你也想快，但要站得住。", stress:"別人越催你越緊，會更想控風險。", tip:"不要催承諾，改問『你還缺什麼資訊』。", line:"你缺X嗎？我補齊後你何時能給結論？"},
  IC:{t:"IC（主I／副C）", out:"重互動也重精準理解，想被懂到點上。", inner:"你在守『不要被曲解』；補細節是為了保護連結的品質。", stress:"越不安越講細；對方接不住時會覺得被敷衍。", tip:"先復述對齊理解，再討論。", line:"我先復述一次，我想確認我有抓到你真正的在意。"},
  CI:{t:"CI（主C／副I）", out:"講邏輯、講一致性，但很在意被認真對待。", inner:"你在守信任與公平：不要敷衍、不要含糊、不要失信。", stress:"對方越隨便你越想講清楚；你越講對方越想逃。", tip:"用例子對齊標準，別只講抽象。", line:"我知道你在守標準，我會照你說的方式做。"},
  IS:{t:"IS（主I／副S）", out:"顧氣氛、願意體諒，跟你相處很舒服。", inner:"你要的是被好好對待：溫度＋安全感。", stress:"越在意越想要回應，但又怕造成壓力，容易內耗。", tip:"不需要大場面，固定回應就很有效。", line:"我在，我會回你，我們慢慢講。"},
  SI:{t:"SI（主S／副I）", out:"穩、可靠、照顧人；你需要互動但不會強硬去要。", inner:"你常把自己放後面，因為你不想麻煩別人。", stress:"更吞、更撐；最痛的是『我很用力顧大家，但沒人顧到我』。", tip:"給明確回應＋看見你的付出，你就會穩很多。", line:"我有看到你在撐，謝謝你。我在。"},
  SC:{t:"SC（主S／副C）", out:"穩、細、默默顧品質；不愛吵但很在意不要亂。", inner:"你在守秩序與安穩：少波動、少重工、大家都好過。", stress:"默默補洞到很累，最後會冷掉，覺得只有自己在收拾。", tip:"把變更機制講清楚、把完成定義訂好。", line:"怎樣算完成？你先訂標準，我照標準交。"},
  CS:{t:"CS（主C／副S）", out:"標準高、仔細，也顧人的承受度；更喜歡把事情做穩。", inner:"你在守品質與安全：希望大家不用靠猜也能把事做對。", stress:"更保守、更想控風險；也可能開始不想講，因為覺得講了也不一定有人照做。", tip:"讓你看到『會照做』比聽到『我知道』更重要。", line:"你列三點標準給我，我照那三點完成。"}
};

/* =========================================================
   3) 計分規則（照你說的）
   - 主型：分數最高
   - 副型：分數第二高；若第二名=0 -> 沒有副型
   - 0 分向度：不顯示
   - 同分時用固定順位 ORDER 讓結果穩定
   ========================================================= */
const ORDER = ["D","I","S","C"];
function ranked(scoreObj){
  return ORDER.map(k=>({k,v:scoreObj[k]}))
    .sort((a,b)=> (b.v-a.v) || (ORDER.indexOf(a.k)-ORDER.indexOf(b.k)));
}
function pickPrimarySecondary(scoreObj){
  const arr = ranked(scoreObj);
  const primary = arr[0];
  const secondary = arr[1];
  const primaryKey = primary.v>0 ? primary.k : "D";
  const secondaryKey = (secondary.v>0) ? secondary.k : null;
  return {arr, primaryKey, secondaryKey};
}

/* =========================================================
   4) 互動狀態
   ========================================================= */
let currentKey = null;
let qIndex = 0;
let scores = {D:0,I:0,S:0,C:0};

const $ = (id)=>document.getElementById(id);

function resetSection(){
  qIndex = 0;
  scores = {D:0,I:0,S:0,C:0};
  $("result").innerHTML = "";
  renderQuestion();
}

function buildResult(){
  const sec = BANK[currentKey];
  const total = Object.values(scores).reduce((a,b)=>a+b,0);
  const {arr, primaryKey, secondaryKey} = pickPrimarySecondary(scores);
  const primary = TYPE_MAIN[primaryKey];

  const nonZero = arr.filter(x=>x.v>0);
  const secondaryLabel = secondaryKey ? secondaryKey : "沒有";
  const comboKey = secondaryKey ? `${primaryKey}${secondaryKey}` : null;
  const combo = comboKey ? COMBO[comboKey] : null;

  // 給使用者看的「結果摘要」
  const summaryTemplate = `
    <div class="box">
      <h2 style="margin-top:0">你的結果（${sec.name}）</h2>
      <div class="tag">主型：<b style="color:var(--text)">${primaryKey}</b></div>
      <div class="tag">副型：<b style="color:var(--text)">${secondaryLabel}</b></div>
      <div class="tag">題數：<b style="color:var(--text)">${sec.questions.length}</b></div>

      <div class="divider"></div>

      <div class="quote">
        <b>${primary.title}</b><br/>
        ${primary.hook}
      </div>

      <div class="grid" style="margin-top:12px">
        <div class="box">
          <h3>你在乎什麼</h3>
          <ul>${primary.care.map(x=>`<li>${x}</li>`).join("")}</ul>
        </div>
        <div class="box">
          <h3>你其實害怕什麼</h3>
          <ul>${primary.fear.map(x=>`<li>${x}</li>`).join("")}</ul>
        </div>
        <div class="box">
          <h3>壓力大時容易出現</h3>
          <ul>${primary.stress.map(x=>`<li>${x}</li>`).join("")}</ul>
        </div>
        <div class="box">
          <h3>你想被怎麼對待</h3>
          <ul>${primary.want.map(x=>`<li>${x}</li>`).join("")}</ul>
        </div>
      </div>

      <div class="box" style="margin-top:12px">
        <h3 style="margin-top:0">超有感模組/h3>
        <div class="grid">
          <div class="box">
            <div class="pill"><b style="color:var(--accent)">你一焦慮就會…</b></div>
            <ul>${primary.module.anxiety.map(x=>`<li>${x}</li>`).join("")}</ul>
          </div>
          <div class="box">
            <div class="pill"><b style="color:var(--accent)">所以別人可能誤會你…</b></div>
            <ul>${primary.module.misread.map(x=>`<li>${x}</li>`).join("")}</ul>
          </div>
        </div>
        <div class="quote"><b>對你最有效的一句話：</b><br/>${primary.module.line}</div>
      </div>
  

      <div class="box" style="margin-top:12px">
        <h3 style="margin-top:0">分數分布</h3>
        <table class="table">
          <thead><tr><th>向度</th><th>分數</th><th>比例</th></tr></thead>
          <tbody>
            ${nonZero.map(x=>`
              <tr>
                <td>${x.k}</td>
                <td>${x.v}</td>
                <td>${pct(x.v,total)}%</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
        <p class="small">主型＝第一名；副型＝第二名；第二名若為 0，依規則判定「沒有副型」。</p>
      </div>

      <div class="box" style="margin-top:12px">
        <h3 style="margin-top:0">主＋副型解析（每組都不同）</h3>
        ${
          combo
          ? `
            <div class="pill"><b style="color:var(--accent)">${combo.t}</b><span class="badge ok">有副型</span></div>
            <ul>
              <li><b>外顯：</b>${combo.out}</li>
              <li><b>內在：</b>${combo.inner}</li>
              <li><b>壓力時：</b>${combo.stress}</li>
              <li><b>相處建議：</b>${combo.tip}</li>
            </ul>
            <div class="quote"><b>一句話最有效：</b><br/>「${combo.line}」</div>
          `
          : `
            <div class="pill"><b style="color:var(--accent)">沒有副型</b><span class="badge warn">第二名為 0</span></div>
            <p>你這次的第二名分數是 0，所以依你的規則判定為「沒有副型」。</p>
            <p class="small">通常代表：這個面向的你反應很集中、很一致，主型特徵特別明顯。</p>
          `
        }
      </div>

      <div class="box" style="margin-top:12px">
        <h3 style="margin-top:0">結果頁兩句「很像被說中」的句型（可直接用）</h3>
        <ul>
          <li>「你看起來像＿＿＿＿，其實你是在守＿＿＿＿。」</li>
          <li>「你一焦慮就會＿＿＿＿，所以別人可能誤會你＿＿＿＿。」</li>
        </ul>
      </div>

    </div>
  `;

  return summaryTemplate;
}

function start(key){
  currentKey = key;
  $("menu").style.display = "none";
  $("testArea").style.display = "block";
  $("subtitle").textContent = BANK[key].intro;
  $("sectionPill").innerHTML = `<b style="color:var(--accent)">${BANK[key].name}</b>`;
  resetSection();
}

function goHome(){
  currentKey = null;
  $("menu").style.display = "grid";
  $("testArea").style.display = "none";
  $("subtitle").textContent = "選一個面向開始作答（各 12 題）。每個面向獨立作業，完成就立刻出結果。";
  $("result").innerHTML = "";
}

function renderMenu(){
  $("menu").innerHTML = `
    <button onclick="start('life')">
      <b style="color:var(--accent)">開始：生活面向</b><br/>
      <span class="small">${BANK.life.intro}</span>
    </button>
    <button onclick="start('work')">
      <b style="color:var(--accent)">開始：工作面向</b><br/>
      <span class="small">${BANK.work.intro}</span>
    </button>
    <button onclick="start('love')">
      <b style="color:var(--accent)">開始：感情面向</b><br/>
      <span class="small">${BANK.love.intro}</span>
    </button>
  `;
}

function renderQuestion(){
  const sec = BANK[currentKey];
  $("qPill").innerHTML = `<b style="color:var(--accent)">第 ${Math.min(qIndex+1, sec.questions.length)} / ${sec.questions.length} 題</b>`;

  // 完成：立刻出結果
  if(qIndex >= sec.questions.length){
    $("question").textContent = "已完成（立刻產出結果）";
    $("options").innerHTML = "";
    $("result").innerHTML = buildResult();
    return;
  }

  const q = sec.questions[qIndex];
  $("question").textContent = q.q;

  // 每題顯示時都亂序（不顯示 D/I/S/C）
  const opts = shuffle(q.o);

  const box = $("options");
  box.innerHTML = "";
  opts.forEach((opt,i)=>{
    const b = document.createElement("button");
    b.innerHTML = `<b style="color:var(--accent)">(${String.fromCharCode(65+i)})</b> ${opt.t}`;
    b.onclick = ()=>pick(opt);
    box.appendChild(b);
  });
}

function pick(opt){
  scores[opt.k] += 1;
  qIndex += 1;
  renderQuestion();
}

// 綁定按鈕
$("restartBtn").addEventListener("click", resetSection);
$("homeBtn").addEventListener("click", goHome);
window.start = start;

// init
renderMenu();
goHome();
</script>
</body>
</html>


