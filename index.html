<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DISC測驗</title>
  <style>
    :root{
      --bg:#0b1220; --card:#121b2e; --line:#24304c;
      --text:#e9eefc; --muted:#b7c0da; --btn:#1e2a46; --btn2:#2b3a6b;
      --accent:#7aa2ff; --soft:#0e1630;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:"Noto Sans TC","Microsoft JhengHei",system-ui,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px}
    h1{margin:0 0 10px;font-size:22px}
    h2{margin:14px 0 8px;font-size:18px}
    p{margin:8px 0;line-height:1.75;color:var(--muted)}
    .small{font-size:13px;color:var(--muted)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--line);border-radius:999px;color:var(--muted)}
    .q{font-size:18px;color:var(--text);margin-top:14px}
    .opts{margin-top:10px;display:grid;gap:10px}
    button{
      width:100%;text-align:left;padding:14px;border-radius:12px;border:1px solid var(--line);
      background:var(--btn);color:var(--text);font-size:16px;cursor:pointer
    }
    button:hover{background:var(--btn2)}
    button.secondary{background:transparent;color:var(--muted)}
    button.secondary:hover{background:var(--soft)}
    button.smallBtn{padding:10px 12px;font-size:14px}
    .footer{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:6px 10px;margin:6px 6px 0 0;color:var(--muted);font-size:13px}
    .box{background:var(--soft);border:1px solid var(--line);border-radius:16px;padding:14px}
    ul{margin:8px 0 0 18px;color:var(--text);line-height:1.75}
    li{margin:6px 0}
    .table{width:100%;border-collapse:collapse;margin-top:8px}
    .table th,.table td{border-bottom:1px solid var(--line);padding:10px 6px;text-align:left}
    .menuGrid{display:grid;gap:10px;margin-top:10px}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>DISC測驗</h1>
    <p class="small" id="subtitle">選一個面向開始作答（各 12 題）。每個面向獨立作業，完成就立刻出結果。</p>

    <div id="menu" class="menuGrid"></div>

    <div id="testArea" style="display:none">
      <div class="row" style="margin-top:10px">
        <span class="pill" id="sectionPill"></span>
        <span class="pill" id="qPill"></span>
      </div>

      <div class="q" id="question"></div>
      <div class="opts" id="options"></div>

      <div class="footer">
        <button class="secondary smallBtn" id="restartBtn">重作此面向</button>
        <button class="secondary smallBtn" id="homeBtn">回首頁</button>
      </div>

      <div id="result" style="margin-top:14px"></div>
    </div>
  </div>
</div>

<script>
/** =====================================================
 * 工具：打亂每一題的選項順序（避免被猜出 D/I/S/C）
 * - 顯示時會亂序，但計分仍用原本的 k
 * ===================================================== */
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

/** =========================
 * 題庫：三面向各 12 題（口語化）
 * 注意：每題選項「原始順序」不重要，顯示時都會亂序
 * ========================= */
const BANK = {
  life: {
    key: "life",
    name: "生活面向",
    intro: "比較像是日常版本的你：遇到插隊、變動、人際互動時，你會怎麼反應。",
    questions: [
      {q:"行程突然改掉（例如臨時延期/換地點），你通常第一個動作是？",
       o:[{k:"S",t:"先讓自己穩一下，照原本節奏慢慢調整"},
          {k:"C",t:"先問清楚原因和限制，再決定要怎麼改"},
          {k:"I",t:"先跟相關的人講一下、對一下狀況"},
          {k:"D",t:"直接改計畫，立刻把下一步排出來"}]},
      {q:"你要買一個不便宜的東西（手機/課程/家電），你比較像哪一種？",
       o:[{k:"I",t:"我看喜不喜歡、用起來心情好不好"},
          {k:"C",t:"我會研究規格、比較評價到很確定"},
          {k:"D",t:"我看值不值得，能不能馬上解決需求"},
          {k:"S",t:"我看是不是耐用、穩、對家裡很友善"}]},
      {q:"朋友傳訊息抱怨一大串，你比較常回哪一種？",
       o:[{k:"C",t:"你先把事情講清楚：發生什麼、你要什麼？"},
          {k:"I",t:"我懂…你先說，我在"},
          {k:"D",t:"好，那我們現在怎麼處理？我幫你拆步驟"},
          {k:"S",t:"先別急，慢慢來，我陪你"}]},
      {q:"你最受不了的日常狀況通常是？",
       o:[{k:"S",t:"一直吵、一直衝突，家裡很不安穩"},
          {k:"D",t:"拖拖拉拉、講半天都沒進度"},
          {k:"C",t:"規則一直變、標準不一、很難配合"},
          {k:"I",t:"大家都悶著不講，氣氛很冷"}]},
      {q:"你壓力很大、很累的時候，你比較像？",
       o:[{k:"D",t:"我會先把最重要的事情清掉，讓自己喘一口氣"},
          {k:"S",t:"我會降低刺激，回到熟悉節奏，慢慢恢復"},
          {k:"I",t:"我會想找人聊一下，不然心裡悶著更累"},
          {k:"C",t:"我會一直整理/檢查，讓混亂變得可控"}]},
      {q:"別人答應你的事又沒做到，你比較常怎麼做？",
       o:[{k:"I",t:"我會用比較不傷人的方式提醒，怕對方有壓力"},
          {k:"C",t:"我會問原因，順便把規則/責任講清楚"},
          {k:"D",t:"我會直接問：那你什麼時候會完成？"},
          {k:"S",t:"我會先忍一下，等時機比較好再說"}]},
      {q:"你做生活決定（要不要換工作/搬家/買車）時，你最在意的是？",
       o:[{k:"S",t:"穩不穩、會不會影響家人跟日常"},
          {k:"D",t:"能不能讓生活更有效率、問題更少"},
          {k:"I",t:"我喜不喜歡、會不會更開心"},
          {k:"C",t:"資訊夠不夠、風險能不能算清楚"}]},
      {q:"你最容易變急，是什麼情境？",
       o:[{k:"C",t:"標準不清楚卻要我負責結果"},
          {k:"I",t:"大家不講清楚，誤會一直累積"},
          {k:"D",t:"我看得到路了，但大家就是不動"},
          {k:"S",t:"節奏一直變，我跟不上也沒人先說"}]},
      {q:"別人請你幫忙，你最常提供的是？",
       o:[{k:"S",t:"我會陪你一起做完，不讓你一個人扛"},
          {k:"D",t:"我可以直接幫你把事情搞定，往前推"},
          {k:"C",t:"我可以幫你整理方法、步驟、注意事項"},
          {k:"I",t:"我可以陪你想方法，也幫你加油"}]},
      {q:"你心裡最想要的生活感受是？",
       o:[{k:"I",t:"有人懂我、有人回應我"},
          {k:"C",t:"規則清楚、事情可預期"},
          {k:"S",t:"穩穩的、不要太多衝突"},
          {k:"D",t:"事情在動、我在掌握中"}]},
      {q:"如果有人跟你說『你最近變了』，你最常是變成哪種？",
       o:[{k:"D",t:"變得更快、更直接、更想把事情定下來"},
          {k:"S",t:"變得比較安靜，想把自己穩住"},
          {k:"I",t:"變得比較需要回應，會更想確認關係"},
          {k:"C",t:"變得更在意細節，怕出錯"}]},
      {q:"回想最近的你，在日常裡更像哪一種狀態？",
       o:[{k:"C",t:"我在補細節、控品質、避免出錯"},
          {k:"D",t:"我在推動前進、把卡點清掉"},
          {k:"S",t:"我在穩住生活、顧好日常"},
          {k:"I",t:"我在撐互動、讓關係好溝通"}]},
    ]
  },

  work: {
    key: "work",
    name: "工作面向",
    intro: "工作版本的你：遇到壓力、合作、變動、被挑戰時，你會怎麼跑。",
    questions: [
      {q:"急件來了但資訊不全，你通常會先？",
       o:[{k:"C",t:"先補資料和風險，不然我不敢亂走"},
          {k:"D",t:"先做可逆決策，推進再修正"},
          {k:"I",t:"先找關鍵人對齊，讓大家同頻"},
          {k:"S",t:"先穩住既有進度，避免牽連更多人"}]},
      {q:"開會開很久沒結論，你通常會？",
       o:[{k:"I",t:"我會提問拉共識，讓大家願意選"},
          {k:"C",t:"我會把標準拉出來：到底怎樣才算完成？"},
          {k:"D",t:"我會收斂選項，直接定下一步"},
          {k:"S",t:"我會先聽各方，避免衝突升高"}]},
      {q:"你最受不了的同事/合作狀況是？",
       o:[{k:"D",t:"拖、推不動、沒人承擔"},
          {k:"S",t:"變動太快、一直逼，氣氛緊張"},
          {k:"I",t:"合作冷、互動差、很難好好講"},
          {k:"C",t:"標準不清、一直改、品質粗糙"}]},
      {q:"你帶人/協作時，你心裡最在意的是？",
       o:[{k:"S",t:"節奏要穩，別讓人壓力爆掉"},
          {k:"D",t:"權責要清楚、要能推進結果"},
          {k:"C",t:"流程要一致、可追蹤可複製"},
          {k:"I",t:"動機要在，人才願意跟"}]},
      {q:"當你被質疑/挑戰，你比較常怎麼回？",
       o:[{k:"C",t:"我會拿依據、邏輯、脈絡把它釐清"},
          {k:"S",t:"我會先退一步，避免硬碰硬"},
          {k:"D",t:"我會回到目標與成效，談結果"},
          {k:"I",t:"我會先看對方狀態，調整說法"}]},
      {q:"壓力一大，你最像哪一種？",
       o:[{k:"I",t:"更在意回應與認同，想把互動顧住"},
          {k:"D",t:"更快、更直接、更想立刻定案"},
          {k:"C",t:"更想把標準釐清，反覆檢查避免錯"},
          {k:"S",t:"更想維持穩定，先把壓力吞下來"}]},
      {q:"你做決策最靠的是？",
       o:[{k:"D",t:"時效與影響力：先定方向比較重要"},
          {k:"C",t:"資料與可驗證：我想先確認正確"},
          {k:"S",t:"風險與穩定：先確保不翻車"},
          {k:"I",t:"團隊與回饋：先確定大家能一起走"}]},
      {q:"你最常被稱讚的工作特質是？",
       o:[{k:"C",t:"細、準、品質好"},
          {k:"I",t:"會溝通、能帶動"},
          {k:"S",t:"可靠、穩、能陪跑"},
          {k:"D",t:"有效率、敢決斷、扛得住"}]},
      {q:"別人跟不上你期待的節奏，你比較常？",
       o:[{k:"S",t:"先降低要求，慢慢把人帶上來"},
          {k:"C",t:"把標準和範例講清楚，減少落差"},
          {k:"D",t:"把里程碑定好，要求回報"},
          {k:"I",t:"多說明與鼓舞，讓對方願意動"}]},
      {q:"你比較像哪種主管/同事？",
       o:[{k:"I",t:"我會把大家連起來，讓合作順"},
          {k:"D",t:"我會把事情推進到完成"},
          {k:"S",t:"我會把節奏穩住，不讓人崩"},
          {k:"C",t:"我會把標準顧好，避免重工"}]},
      {q:"你最怕的是？",
       o:[{k:"C",t:"做了半天方向錯，後面全重來"},
          {k:"S",t:"氣氛太緊，大家最後都不想合作"},
          {k:"I",t:"大家不說真話，只剩表面配合"},
          {k:"D",t:"機會來了卻不推，拖到錯過"}]},
      {q:"回顧近期工作狀態，你更像？",
       o:[{k:"D",t:"推進、定案、把卡點打通"},
          {k:"I",t:"串聯、對齊、讓大家好合作"},
          {k:"C",t:"補洞、控標準、把品質拉起來"},
          {k:"S",t:"穩住、陪跑、維持團隊節奏"}]},
    ]
  },

  love: {
    key: "love",
    name: "感情面向",
    intro: "親密關係版本的你：你在乎什麼、怕什麼、需要怎樣的對待才會安心。",
    questions: [
      {q:"你覺得關係怪怪的時，你通常先？",
       o:[{k:"I",t:"我想先談談感受，想要對方回應"},
          {k:"C",t:"我會回想細節，想弄清楚原因"},
          {k:"S",t:"我先觀察一下，避免衝突變大"},
          {k:"D",t:"我會直接問清楚，想把狀態拉回來"}]},
      {q:"對方情緒很大時，你比較常？",
       o:[{k:"S",t:"先安撫和陪伴，讓他慢慢穩下來"},
          {k:"D",t:"先把問題框起來：那我們要怎麼處理？"},
          {k:"I",t:"先接住：我在，你先說"},
          {k:"C",t:"先釐清發生什麼，避免越吵越誤會"}]},
      {q:"你在感情裡最怕的是？",
       o:[{k:"D",t:"問題一直拖，對方不負責"},
          {k:"I",t:"互動冷，像被晾著"},
          {k:"C",t:"說法反覆、標準不一、邏輯對不上"},
          {k:"S",t:"衝突太多，沒有安穩感"}]},
      {q:"你最容易覺得安心的是？",
       o:[{k:"C",t:"界線清楚、規則一致、互相尊重"},
          {k:"S",t:"穩定可預期、彼此溫柔對待"},
          {k:"I",t:"有連結、有交流、被在乎"},
          {k:"D",t:"說到做到、問題能被處理"}]},
      {q:"你受傷或不舒服時，你比較常？",
       o:[{k:"C",t:"一直想：是不是我哪裡講錯、做錯"},
          {k:"S",t:"先忍一下，怕講了更糟"},
          {k:"I",t:"想把感受說出來，希望對方理解"},
          {k:"D",t:"我會想直接談：以後怎麼改善"}]},
      {q:"你表達在乎比較像？",
       o:[{k:"I",t:"陪你聊、分享、讓你感覺被放在心上"},
          {k:"D",t:"幫你解決、幫你扛、讓你更好"},
          {k:"S",t:"穩定地在、照顧你、讓你有依靠"},
          {k:"C",t:"把細節做好、把承諾做到、讓你放心"}]},
      {q:"對方跟你期待不同時，你比較常？",
       o:[{k:"D",t:"我會直接講底線和期待，想調整"},
          {k:"S",t:"我會先退一步，找合適時機再談"},
          {k:"C",t:"我會用具體例子講清楚原因"},
          {k:"I",t:"我會用比較柔的方式說，怕傷到對方"}]},
      {q:"關係壓力變大時，你最可能變成？",
       o:[{k:"S",t:"更想維持平和，寧可自己吞"},
          {k:"I",t:"更需要確認和回應，怕被忽略"},
          {k:"C",t:"更想確認一致性，避免被反覆"},
          {k:"D",t:"更想掌控走向，要求立刻處理"}]},
      {q:"你覺得對方不理解你時，你腦中比較像？",
       o:[{k:"I",t:"我需要你聽懂我的感受"},
          {k:"D",t:"那我用行動/結果證明給你看"},
          {k:"S",t:"我不想吵，先算了"},
          {k:"C",t:"是不是我表達不夠清楚"}]},
      {q:"你比較受不了哪一種溝通？",
       o:[{k:"C",t:"說法一直改，前後矛盾"},
          {k:"I",t:"冷處理、已讀不回"},
          {k:"S",t:"大吵大鬧、情緒勒索"},
          {k:"D",t:"講一堆但不處理問題"}]},
      {q:"你想要的陪伴比較像？",
       o:[{k:"S",t:"穩穩在，不用很多話也安心"},
          {k:"I",t:"多交流、多互動、有來有往"},
          {k:"C",t:"清楚說好規則和界線，彼此更放心"},
          {k:"D",t:"一起把問題處理掉，往更好的方向走"}]},
      {q:"回顧你在關係裡的樣子，你更像？",
       o:[{k:"D",t:"把關係往前推、把問題處理掉的人"},
          {k:"S",t:"把日常顧好、把安穩維持住的人"},
          {k:"I",t:"把互動做熱、把連結撐住的人"},
          {k:"C",t:"把承諾與界線做好、把信任撐住的人"}]},
    ]
  }
};

/** =========================
 * 主型（口語、好理解）
 * ========================= */
const TYPE_CORE = {
  D:{headline:"你比較像「推動前進的人」",feel:"你在乎的是：事情要往前，不要卡在原地。",need:"你需要的不是別人完美，而是『有回應、有進度、有下一步』。"},
  I:{headline:"你比較像「把人連起來的人」",feel:"你在乎的是：有互動、有回應、有一起的感覺。",need:"你需要的是『被回應、被理解、被放在心上』。"},
  S:{headline:"你比較像「把局穩住的人」",feel:"你在乎的是：穩、順、不要互相傷到。",need:"你需要的是『可預期、被體諒節奏、溫和但清楚的界線』。"},
  C:{headline:"你比較像「把品質顧好的人」",feel:"你在乎的是：清楚、正確、不要一直反覆。",need:"你需要的是『定義清楚、標準一致、資訊足夠』。"}
};

/** =========================
 * 12 組主輔（複型）— 每組不同解析
 * ========================= */
const COMBO = {
  DI:{title:"DI型（主D／副I）",one:"你是那種：先把事推動起來，也會在意大家跟不跟得上。",deep:"你不只是要快，你要的是『一起快』。所以你會推進，也會想把人拉回同一邊。",stress:"壓力大時你會更直、更快定案；你心裡其實在說：別再卡了。",tip:"把推進說成邀請：『我想往前，也想顧到你。A或B你選哪個比較做得到？』"},
  DS:{title:"DS型（主D／副S）",one:"你是那種：要推進，但不想把人壓垮。",deep:"你會扛，是因為你想讓局面穩住。你推得快，常是為了保護整體不失控。",stress:"你可能表面更硬，內在更怕事情拖到翻車、也怕關係受傷。",tip:"用流程保速度：里程碑＋回報點，推進不用靠催。"},
  DC:{title:"DC型（主D／副C）",one:"你是那種：先定方向，再把標準補齊的人。",deep:"你要快，但更怕後面重來；你追的是『快＋不留後遺症』。",stress:"你會變得又快又嚴，因為你在防止『之後更麻煩』。",tip:"一句話：『先走A；如果出現B，我們就調整。』"},

  ID:{title:"ID型（主I／副D）",one:"你是那種：先連上人，再把事情推進的人。",deep:"你需要先有同一邊的感覺，有了這個，你的行動力會很強。",stress:"拿不到回應時你會從溫柔變急；其實你在要一個安心。",tip:"把確認改成約定：『我想對齊一下，我們今晚9點聊10分鐘可以嗎？』"},
  IS:{title:"IS型（主I／副S）",one:"你是那種：很在乎互動，也很在乎舒服的人。",deep:"你不想吵，你只想被好好對待；你會顧氣氛，也會顧承受度。",stress:"你越在意越想要回應，但又怕造成壓力，所以容易內耗。",tip:"把期待縮小成可做到的請求：『你今天回我一句就好。』"},
  IC:{title:"IC型（主I／副C）",one:"你是那種：要被懂，而且要被懂得很精準的人。",deep:"你補細節不是囉嗦，是你怕誤會把距離拉遠。",stress:"你越不安會講越多；對方接不住時你會覺得被敷衍。",tip:"先一句結論＋兩個重點：『我在意X和Y，細節我再補。』"},

  SD:{title:"SD型（主S／副D）",one:"你是那種：先穩住局面，但該推就會推的人。",deep:"你多半先顧和氣與節奏；但覺得一直拖時，你會用推進把局勢拉回來。",stress:"你容易忍到最後才一次講很重，別人會以為你突然翻臉。",tip:"提早說10%的需求：『我需要提前一天知道變更。』"},
  SI:{title:"SI型（主S／副I）",one:"你是那種：很會照顧人，也很需要被回應的人。",deep:"你把關係放很前面，所以常先委屈自己，讓大家都舒服。",stress:"你會更吞、更安撫，但心裡其實很想聽到一句『我知道』。",tip:"一句話：『你回我一句，我會安心很多。』"},
  SC:{title:"SC型（主S／副C）",one:"你是那種：要穩，也要規則清楚的人。",deep:"你不怕做事，你怕的是一直改、一直反覆；你要的是可預期。",stress:"你會默默補洞、默默收拾，最後把自己累壞。",tip:"先講清3件事：完成定義、期限、回報格式。"},

  CD:{title:"CD型（主C／副D）",one:"你是那種：先確認正確，確定後推很快的人。",deep:"你不是慢，你是在保護結果不要翻車；你要的是『對了再快』。",stress:"別人越催你越緊；你心裡在想：你催我，出事誰扛？",tip:"直接講承諾：『我缺X，拿到後我在Y小時內給結論。』"},
  CI:{title:"CI型（主C／副I）",one:"你是那種：要一致，也要被公平理解的人。",deep:"你在守信任：不要誤會、不要失信；你希望對方認真聽。",stress:"對方越隨便你越想講清楚；你越講對方越想逃。",tip:"用例子最有力：『上次X讓我不安，所以我需要Y標準。』"},
  CS:{title:"CS型（主C／副S）",one:"你是那種：把事做對，也把人顧好的人。",deep:"你可靠到讓人放心，但也最容易累；你常把責任與關係一起扛。",stress:"你會越補越多，最後覺得只有你在扛。",tip:"把照顧變制度：完成定義＋回報節奏，別一直救火。"},
};

/** =========================
 * 計分規則（照你說的）
 * - 主型：第一名（分數最高）
 * - 副型：第二名（分數次高）
 * - 分數為 0 的向度：視為「沒有」（不顯示）
 * - 第二名如果是 0：判定「沒有副型」
 * ========================= */
let currentKey = null;
let qIndex = 0;
let scores = {D:0,I:0,S:0,C:0};

const $ = (id)=>document.getElementById(id);
const ORDER = ["D","I","S","C"]; // 同分時的固定順位（避免結果飄來飄去）

function pct(v,total){ return total===0 ? 0 : Math.round((v/total)*100); }

function ranked(scoreObj){
  return ORDER.map(k=>({k,v:scoreObj[k]}))
    .sort((a,b)=> (b.v-a.v) || (ORDER.indexOf(a.k)-ORDER.indexOf(b.k)));
}

function pickPrimarySecondary(scoreObj){
  const arr = ranked(scoreObj);
  const primary = arr[0];
  const secondary = arr[1];
  const primaryKey = primary.v>0 ? primary.k : "D";
  const secondaryKey = (secondary.v>0) ? secondary.k : null;
  return {arr, primaryKey, secondaryKey};
}

function resetSection(){
  qIndex = 0;
  scores = {D:0,I:0,S:0,C:0};
  $("result").innerHTML = "";
  renderQuestion();
}

function buildResult(){
  const total = Object.values(scores).reduce((a,b)=>a+b,0);
  const {arr, primaryKey, secondaryKey} = pickPrimarySecondary(scores);
  const main = TYPE_CORE[primaryKey];

  const nonZero = arr.filter(x=>x.v>0);
  const comboKey = secondaryKey ? `${primaryKey}${secondaryKey}` : null;
  const combo = comboKey ? COMBO[comboKey] : null;

  const secondaryLabel = secondaryKey ? secondaryKey : "沒有";

  let comboBlock = "";
  if(combo){
    comboBlock = `
      <div class="box" style="margin-top:12px">
        <h2 style="margin-top:0">副型分析：${combo.title}</h2>
        <p style="color:var(--text)"><b>${combo.one}</b></p>
        <ul>
          <li><b>你其實在守什麼：</b>${combo.deep}</li>
          <li><b>壓力大時會怎麼跑出來：</b>${combo.stress}</li>
        </ul>
        <p class="small" style="color:var(--text)"><b>一句話就能更順：</b>${combo.tip}</p>
      </div>
    `;
  } else {
    comboBlock = `
      <div class="box" style="margin-top:12px">
        <h2 style="margin-top:0">副型分析</h2>
        <p>你這次的第二名分數是 0，所以依規則判定為「沒有副型」。</p>
        <p class="small">這通常代表：在這個面向裡，你的反應很集中，主型特徵非常明顯。</p>
      </div>
    `;
  }

  return `
    <div class="box">
      <h2 style="margin-top:0">你的結果（這個面向）</h2>
      <div class="tag">主型：<b style="color:var(--text)">${primaryKey}</b></div>
      <div class="tag">副型：<b style="color:var(--text)">${secondaryLabel}</b></div>

      <div class="box" style="margin-top:12px">
        <h2 style="margin-top:0">一句話形容你</h2>
        <p style="color:var(--text)"><b>${main.headline}</b></p>
        <p>${main.feel}</p>
        <p class="small" style="color:var(--text)"><b>你比較需要：</b>${main.need}</p>
      </div>

      <h2>分數分布（0 不顯示）</h2>
      <table class="table">
        <thead><tr><th>向度</th><th>分數</th><th>比例</th></tr></thead>
        <tbody>
          ${nonZero.map(x=>`
            <tr>
              <td>${x.k}</td>
              <td>${x.v}</td>
              <td>${pct(x.v,total)}%</td>
            </tr>
          `).join("")}
        </tbody>
      </table>

      ${comboBlock}
    </div>
  `;
}

function start(key){
  currentKey = key;
  $("menu").style.display = "none";
  $("testArea").style.display = "block";
  $("subtitle").textContent = BANK[key].intro;
  $("sectionPill").innerHTML = `<b style="color:var(--accent)">${BANK[key].name}</b>`;
  resetSection();
}

function goHome(){
  currentKey = null;
  $("menu").style.display = "grid";
  $("testArea").style.display = "none";
  $("subtitle").textContent = "選一個面向開始作答（各 12 題）。每個面向獨立作業，完成就立刻出結果。";
  $("result").innerHTML = "";
}

function renderMenu(){
  $("menu").innerHTML = `
    <button onclick="start('life')">
      <b style="color:var(--accent)">開始：生活面向</b><br/>
      <span class="small">${BANK.life.intro}</span>
    </button>
    <button onclick="start('work')">
      <b style="color:var(--accent)">開始：工作面向</b><br/>
      <span class="small">${BANK.work.intro}</span>
    </button>
    <button onclick="start('love')">
      <b style="color:var(--accent)">開始：感情面向</b><br/>
      <span class="small">${BANK.love.intro}</span>
    </button>
  `;
}

function renderQuestion(){
  const sec = BANK[currentKey];
  $("qPill").innerHTML = `<b style="color:var(--accent)">第 ${Math.min(qIndex+1, sec.questions.length)} / ${sec.questions.length} 題</b>`;

  // ✅ 完成後立刻出結果（獨立，不聯動）
  if(qIndex >= sec.questions.length){
    $("question").textContent = "已完成（立刻產出結果）";
    $("options").innerHTML = "";
    $("result").innerHTML = buildResult();
    return;
  }

  const q = sec.questions[qIndex];
  $("question").textContent = q.q;

  // ✅ 每題顯示時都亂序（避免被猜出哪個是 D/I/S/C）
  const opts = shuffle(q.o);

  const box = $("options");
  box.innerHTML = "";
  opts.forEach((opt,i)=>{
    const b = document.createElement("button");
    // 不顯示 D/I/S/C，只顯示 A/B/C/D
    b.innerHTML = `<b style="color:var(--accent)">(${String.fromCharCode(65+i)})</b> ${opt.t}`;
    b.onclick = ()=>pick(opt);
    box.appendChild(b);
  });
}

function pick(opt){
  scores[opt.k] += 1;
  qIndex += 1;
  renderQuestion();
}

$("restartBtn").addEventListener("click", resetSection);
$("homeBtn").addEventListener("click", goHome);
window.start = start;

// init
renderMenu();
goHome();
</script>
</body>
</html>
